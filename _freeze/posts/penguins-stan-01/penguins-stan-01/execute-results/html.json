{
  "hash": "820dbebb837ff824b785b5b6f57908b5",
  "result": {
    "engine": "knitr",
    "markdown": "---\nextype: string\nexsolution: NA\nexname: penguins-stan-01\nexpoints: 1\ncategories:\n- bayes\n- regression\n- string\ndate: '2023-07-12'\nslug: penguins-stan-01\ntitle: penguins-stan-01\n\n---\n\n\n\n\n\n\n# Aufgabe\n\n\nWir untersuchen Einflussfaktoren bzw. Prädiktoren auf das Körpergewicht von Pinguinen.\nIn dieser Aufgabe untersuchen wir in dem Zusammenhang den Zusammenhang von *Schnabellänge* (als UV) und Körpergewicht (als AV).\n\n\n*Wie groß ist der statistische Einfluss der UV auf die AV?*\n\na) Berechnen Sie den *Punktschätzer* des Effekts!\nb) *Wie viele Parameter* hat das Modell?\nc) Geben Sie die *Breite eines 90%-HDI* an (zum Effekt)!\nd) Wie groß ist die Wahrscheinlichkeit, dass der Effekt vorhanden ist (also größer als Null ist), die \"*Effektwahrscheinlichkeit*\"?\ne) Wie groß ist das 95%-HDI, wenn Sie *nur* die Spezies *Adelie* untersuchen?\nf) Geben Sie die *Prioris* an für `m1` für die Regressionskoeffizienten!\n\n\nHinweise:\n\n- Nutzen Sie den Datensatz zu den *Palmer Penguins*.\n- Verwenden Sie Methoden der Bayes-Statistik und die Software Stan.\n- Fixieren Sie die Zufallszahlen auf den Startwert 42!\n- Sie können den Datensatz z.B. [hier](https://vincentarelbundock.github.io/Rdatasets/csv/palmerpenguins/penguins.csv) beziehen oder über das R-Paket `palmerpenguins`.\n- Geben Sie keine Prozentzahlen, sondern stets Anteile an.\n- Beachten Sie die [übrigen Hinweise](https://datenwerk.netlify.app/hinweise).\n\n\n\n\n\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n\n# Lösung\n\nZentrieren ist eigentlich immer nützlich,\naber hier streng genommen nicht unbedingt nötig.\nDer Hauptgrund ist, dass Stan für uns den Prior für den Intercept festlegt,\nund zwar auf Basis der Daten,\nwir uns also nicht um die komische Frage zu kümmern brauchen,\nwelchen Prior wir für den unzentrierten Achsenabschnitt vergeben wollten:\nWie schwer sind Pinguins der Schnabellänge Null?\nMit zentrierten Prädiktoren ist die Frage nach dem Prior viel einfacher zu beantworten:\nWie schwer ist ein Pinguin mit mittelgroßem Schnabel?\n\nSetup:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(easystats)\nlibrary(rstanarm)\n\ndata(\"penguins\", package = \"palmerpenguins\")\n```\n:::\n\n\n\nEs wird in dieser Aufgabe vorausgesetzt,\ndass Sie den Datensatz selbständig importieren können.\nTipp: Kurzes Googeln hilft ggf., den Datensatz zu finden.\n\n\n\nAlternativ könnten Sie den Datensatz als CSV-Datei importieren:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_path <- \"https://vincentarelbundock.github.io/Rdatasets/csv/palmerpenguins/penguins.csv\"\npenguins <- data_read(d_path)  # oder z.B. mit read_csv \n```\n:::\n\n\n\nEin Blick in die Daten zur Kontrolle,\nob das Importieren richtig funktioniert hat:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <fct> male, female, female, NA, female, male, female, male…\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n\n\n:::\n:::\n\n\n\nVertrauen ist gut, aber - was Golems betrifft - ist Kontrolle eindeutig besser ;-)\n\n\n\n\na) Punktschätzer\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- stan_glm(body_mass_g ~  bill_length_mm,  # Regressionsgleichung\n               data = penguins, #  Daten\n               seed = 42,  # Reproduzierbarkeit\n               refresh = 0)  # nicht so viel Output\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nparameters(m1, ci_method = \"hdi\", ci = .9)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter      | Median |            90% CI |     pd |  Rhat |     ESS |                       Prior\n----------------------------------------------------------------------------------------------------\n(Intercept)    | 361.85 | [-108.79, 834.20] | 89.55% | 0.999 | 3920.00 | Normal (4201.75 +- 2004.89)\nbill_length_mm |  87.45 | [  77.17,  98.51] |   100% | 0.999 | 3931.00 |     Normal (0.00 +- 367.22)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nUncertainty intervals (highest-density) and p-values (two-tailed)\n  computed using a MCMC distribution approximation.\n```\n\n\n:::\n:::\n\n\n\nb) Anzahl Parameter\n\nDas Modell hat 3 Paramter:\n\n- $\\beta_0$ (oder $\\alpha$)\n- $\\beta_01$\n- $\\sigma$\n\n\nc) Breite des Intervalls\n\nDazu liest man die Intervallgrenzen (`90% CI`) in der richtigen Zeile ab (Tabelle `parameters`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n 97.70  - 76.24\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 21.46\n```\n\n\n:::\n:::\n\n\nEinheit: mm\n\n\nd) Effektwahrscheinlichkeit\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_post <-\n  m1 %>% \n  as_tibble()\n\nm1_post %>% \n  count(bill_length_mm > 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  `bill_length_mm > 0`     n\n  <lgl>                <int>\n1 TRUE                  4000\n```\n\n\n:::\n:::\n\n\nAlso: 100% oder 1 (4000 von 4000 Stichproben finden dieses Ergebnis in unserem Modell). \n\nMan kann diesen Wert aus der Tabelle oben (Ausgabe von `parameters()`) einfach in der Spalte `pd` ablesen.\n`pd` steht für *probability of direction*, s. [Details hier](https://easystats.github.io/blog/posts/bayestestr_pd/).\n\n\nOder so, ist auch einfach:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npd_m1 <- p_direction(m1) # aus Paket easystats\npd_m1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nProbability of Direction\n\nParameter      |     pd\n-----------------------\n(Intercept)    | 89.55%\nbill_length_mm |   100%\n```\n\n\n:::\n:::\n\n\nUnd plotten ist meist hilfreich: `plot(pd_m1)`.\n\nMan kann sich auch ein \"Dashboard\" mit allen Ergebnissen des Modells ausgeben lassen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_dashboard(m1)\n```\n:::\n\n\n\n\ne) Nur Adelie:\n\nWelche Spezies gibt es im Datensatz?\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  count(species)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  species       n\n  <fct>     <int>\n1 Adelie      152\n2 Chinstrap    68\n3 Gentoo      124\n```\n\n\n:::\n:::\n\n\n\nFiltern:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_adelie <-\n  penguins %>% \n  filter(species == \"Adelie\")\n```\n:::\n\n\n\nModell berechnen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 <- stan_glm(body_mass_g ~  bill_length_mm,  # Regressionsgleichung\n               data = penguins_adelie, #  Daten\n               seed = 42,  # Repro.\n               refresh = 0)  # nicht so viel Output\n```\n:::\n\n\nDas Modell ist - bis auf die Daten - identisch zu `m1`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparameters(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter      | Median |            95% CI |     pd |  Rhat |     ESS |                       Prior\n----------------------------------------------------------------------------------------------------\n(Intercept)    |  18.20 | [-881.48, 930.13] | 51.75% | 1.000 | 3988.00 | Normal (3700.66 +- 1146.42)\nbill_length_mm |  94.71 | [  71.21, 118.31] |   100% | 1.000 | 3962.00 |     Normal (0.00 +- 430.43)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nUncertainty intervals (equal-tailed) and p-values (two-tailed) computed\n  using a MCMC distribution approximation.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhdi(m2, parameters = \"bill_length_mm\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nHighest Density Interval\n\nParameter      |         95% HDI\n--------------------------------\nbill_length_mm | [70.88, 117.70]\n```\n\n\n:::\n:::\n\n\nS. auch Tabelle oben.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n118.09 - 71.86\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 46.23\n```\n\n\n:::\n:::\n\n\nf) Prioris\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndescribe_prior(m1, component = \"auxiliary\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Parameter Prior_Distribution Prior_Location Prior_Scale\n1    (Intercept)             normal       4201.754   2004.8863\n2 bill_length_mm             normal          0.000    367.2233\n```\n\n\n:::\n:::\n\n\nSteht auch in der Tabelle,\ndie von `parameters` ausgegeben wird.\n\n\n\n---\n\nCategories: \n\n- bayes\n- regression\n- string\n\n",
    "supporting": [
      "penguins-stan-01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}