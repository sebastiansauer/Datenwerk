{
  "hash": "dbe5da538a513fd49bd64a834f286ccf",
  "result": {
    "engine": "knitr",
    "markdown": "---\nextype: string\nexsolution: NA\nexname: pupilsize\nexpoints: 1\ncategories:\n- probability\n- bayes\n- regression\ndate: '2022-11-05'\nslug: Pupil-size\ntitle: Pupil-size\n\n---\n\n\n\n\n\n\n\n\n\n\n\n# Exercise\n\nPupillendaten sind ein verbreiteter Analysegegenstand in Bereichen wie Psychologie, Marktforschung und Marketing.\n\nBetrachten wir dazu ein R-Paket (zum Vorverbarbeitung, preprocessing) \nund einen Datensatz der [Uni Münster](http://cran.uni-muenster.de/web/packages/PupilPre/vignettes/PupilPre_Basic_Preprocessing.html).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(PupilPre)\ndata(\"Pupildat\")\nd <-\n  Pupildat %>% \n  select(size = RIGHT_PUPIL_SIZE,\n         time = TIMESTAMP) %>% \n  mutate(size = size / 100) # in millimeter\n```\n:::\n\n\nMit dem R-Paket `easystats` kann man sich bequem typische Statistiken ausgeben lassen. Aber natürlich können Sie auch mit `summarise(mw = mean(size))` arbeiten.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(easystats)\nd %>% \n  describe_distribution()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nVariable |     Mean |       SD |      IQR |                Range | Skewness | Kurtosis |     n | n_Missing\n----------------------------------------------------------------------------------------------------------\nsize     |    10.01 |     5.11 |     3.88 |        [1.04, 25.01] |     1.25 |     0.32 | 45343 |      1607\ntime     | 2.99e+06 | 9.87e+05 | 1.95e+06 | [1.44e+06, 4.06e+06] |    -0.41 |    -1.70 | 46950 |         0\n```\n\n\n:::\n:::\n\n\n\nWir verzichten hier auf eine Aufbereitung der Daten (was eigentlich nötig wäre, aber nicht Gegenstand dieser Übung ist). \nStattdessen konzentrieren wir uns auf die Posteriori-Verteilung zur Pupillengröße.\n\nWir sind also interessiert an einem Modell zur Schätzung der (Verteilung der) Pupillengröße; \ndie Posteriori-Verteilung bildet das ab.\n\n\na) Formulieren Sie ein passendes Modell.\n\nb) Verteidigen Sie Ihre Modellspezifikation.\n\nc) Simulieren Sie Daten aus der Priori-Verteilung. \nKritisieren Sie die Wahl der Priori-Werte.\n\nd) Berechnen Sie die Posteriori-Verteilung mit den Pupillendaten `d`. \nGeben Sie zentrale Statistiken an.\n\ne) Geben Sie ein 95%-Intervall für die mittlere Pupillengröße an auf Basis der Posteriori-Verteilung.\n\n\n\n\nHinweise:\n\n- Spezifizieren Sie eine Gleichverteilung von 0 bis 20 mm als Prior für die Streuung $\\sigma$.\n\n\n\n\n\n\n\n\n\n\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n\n# Solution\n\n\n\na) Modelldefinition\n\n$$\\begin{aligned}\ns_i &\\sim \\mathcal{N}(\\mu, \\sigma)\\qquad \\text{| s wie size }\\\\\n\\mu &\\sim \\mathcal{N}(10, 5)\\\\\n\\sigma &\\sim \\mathcal{U}(0, 20)\n\\end{aligned}$$\n\nb) Begründung der Modellspezifikation\n\n$s_i$: Pupillengrößen sind normalverteilt, da viele Gene additiv auf die Größe hin zusammenwirken\n\n$\\mu$: Da wir nicht viel wissen über die mittlere Pupillengröße, \nentscheiden wir uns für Normalverteilung für diesen Parameter, \nda dies keine weiteren Annahmen (außer dass Mittelwert und Streuung endlich sind) hinzufügt. \nEin Modell mit wenig Annahmen nennt man \"sparsam\" oder konservativ. \nEs ist wünschenswert, dass Modelle mit so wenig wie möglich Annahmen auskommt (aber so vielen wie nötig).\n\n$\\sigma$: Die Streuung muss positiv sein, \ndaher kommt keine Normalverteilung in Frage.\nEine Gleichverteilung ist *eine von mehreren denkabaren* Verteilungen.\nBesser wäre vermutlich eine Verteilung,\ndie extrem große Werte als zunehmen unwahrscheinlich beurteilt.\nAus Gründen der Einfachheit bleiben wir hier bei der Gleichverteilung.\n\nDie große Stichprobe wird den Priori-Wert vermutlich überstimmen.\n\nc) Priori-Prädiktiv-Verteilung\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 1e4\nsim_prior_pred <-\n  tibble(\n    mu = rnorm(n, mean = 10, sd = 5),\n    sigma = runif(n, min = 0, max = 20),\n    size = rnorm(n, mu, sigma)\n  )\n\nsim_prior_pred %>% \n  ggplot(aes(x = size)) +\n  geom_density()\n```\n\n::: {.cell-output-display}\n![](unnamed-chunk-3-1.png){fig-pos='H' width=384}\n:::\n:::\n\n\nDa es viele negative Pupillengröße-Werte gibt, \nsieht man deutlich, dass das Modell nicht gut spezifiziert ist. \nSo könnte kleinere Streuungswerte zu einem realistischeren Modell führen. \nOder man verwendet Verteilungen, die rein positiv sind (hier nicht weiter ausgeführt).\n\n\nd) Berechnen Sie die Posteriori-Verteilung.\n\nDie Modelle wie `stan_glm()` tun sich leichter, \nwenn man nur die relevanten Daten, ohne fehlende Werte und schon schön fertig vorverarbeitet, \nzur Analyse in die Modellberechnung gibt:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd3 <-\n  d %>% \n  select(size) %>% \n  drop_na()\n```\n:::\n\n\nDie Posteriori-Verteilung kann man mit dem Paket `{rstanarm}` d.h. mit der Funktion `stan_glm()` berechnen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rstanarm)\nm_pupil <- stan_glm(size ~ 1,\n                    data = d3,\n                    refresh = 0)\n```\n:::\n\n\nDie Daten sind groß, es kann ein paar Sekunden brauchen...\n\n\nHier ist eine nützliche Zusammenfassung der Post-Verteilung.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparameters(m_pupil)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Median |        95% CI |   pd |  Rhat |     ESS |                   Prior\n---------------------------------------------------------------------------------------\n(Intercept) |  10.01 | [9.96, 10.05] | 100% | 1.005 | 1949.00 | Normal (10.01 +- 12.77)\n```\n\n\n:::\n:::\n\n\n\nHier eine Visualisierung der Parameter:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(parameters(m_pupil), show_intercept = TRUE)\n```\n\n::: {.cell-output-display}\n![](unnamed-chunk-7-1.png){fig-pos='H' width=384}\n:::\n:::\n\n\n\nNatürlich kann man auch die Post-Verteilung plotten:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_hdi <- hdi(m_pupil, ci = c(0.5, 0.95))\n\nplot(m_hdi, show_intercept = TRUE)\n```\n\n::: {.cell-output-display}\n![](unnamed-chunk-8-1.png){fig-pos='H' width=384}\n:::\n:::\n\n\n\n\n\nHier zur Info die ersten paar Zeilen des Post-Verteilung:\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"nhlxsezmkv\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#nhlxsezmkv table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#nhlxsezmkv thead, #nhlxsezmkv tbody, #nhlxsezmkv tfoot, #nhlxsezmkv tr, #nhlxsezmkv td, #nhlxsezmkv th {\n  border-style: none;\n}\n\n#nhlxsezmkv p {\n  margin: 0;\n  padding: 0;\n}\n\n#nhlxsezmkv .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#nhlxsezmkv .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#nhlxsezmkv .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#nhlxsezmkv .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#nhlxsezmkv .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#nhlxsezmkv .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#nhlxsezmkv .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#nhlxsezmkv .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#nhlxsezmkv .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#nhlxsezmkv .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#nhlxsezmkv .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#nhlxsezmkv .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#nhlxsezmkv .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#nhlxsezmkv .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#nhlxsezmkv .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nhlxsezmkv .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#nhlxsezmkv .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#nhlxsezmkv .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#nhlxsezmkv .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nhlxsezmkv .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#nhlxsezmkv .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nhlxsezmkv .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#nhlxsezmkv .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nhlxsezmkv .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#nhlxsezmkv .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nhlxsezmkv .gt_left {\n  text-align: left;\n}\n\n#nhlxsezmkv .gt_center {\n  text-align: center;\n}\n\n#nhlxsezmkv .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#nhlxsezmkv .gt_font_normal {\n  font-weight: normal;\n}\n\n#nhlxsezmkv .gt_font_bold {\n  font-weight: bold;\n}\n\n#nhlxsezmkv .gt_font_italic {\n  font-style: italic;\n}\n\n#nhlxsezmkv .gt_super {\n  font-size: 65%;\n}\n\n#nhlxsezmkv .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#nhlxsezmkv .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#nhlxsezmkv .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#nhlxsezmkv .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#nhlxsezmkv .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#nhlxsezmkv .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#nhlxsezmkv .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"(Intercept)\">(Intercept)</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sigma\">sigma</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"(Intercept)\" class=\"gt_row gt_right\">10.00</td>\n<td headers=\"sigma\" class=\"gt_row gt_right\">5.11</td></tr>\n    <tr><td headers=\"(Intercept)\" class=\"gt_row gt_right\">9.99</td>\n<td headers=\"sigma\" class=\"gt_row gt_right\">5.12</td></tr>\n    <tr><td headers=\"(Intercept)\" class=\"gt_row gt_right\">10.00</td>\n<td headers=\"sigma\" class=\"gt_row gt_right\">5.13</td></tr>\n    <tr><td headers=\"(Intercept)\" class=\"gt_row gt_right\">10.01</td>\n<td headers=\"sigma\" class=\"gt_row gt_right\">5.10</td></tr>\n    <tr><td headers=\"(Intercept)\" class=\"gt_row gt_right\">9.99</td>\n<td headers=\"sigma\" class=\"gt_row gt_right\">5.12</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\ne) Geben Sie ein 95%-Intervall für die mittlere Pupillengröße an auf Basis der Posteriori-Verteilung.\n\n\n::: {.cell}\n\n```{.r .cell-code}\neti(m_pupil)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEqual-Tailed Interval\n\nParameter   |       95% ETI | Effects |   Component\n---------------------------------------------------\n(Intercept) | [9.96, 10.05] |   fixed | conditional\n```\n\n\n:::\n:::\n\n\n\nUnd dann erstellen wir ein 89%-PI:\n\n\n::: {.cell}\n\n```{.r .cell-code}\neti(m_pupil, ci = .89)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEqual-Tailed Interval\n\nParameter   |       89% ETI | Effects |   Component\n---------------------------------------------------\n(Intercept) | [9.97, 10.04] |   fixed | conditional\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\nCategories: \n\n- probability\n- bayes\n- regression\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}