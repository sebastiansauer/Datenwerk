{
  "hash": "04869497ff75867eebc79386bd6b78f6",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexname: groesse02\nexpoints: 1\nextype: string\nexsolution: NA\ncategories:\n- 2023\n- bayes\n- bayes-box\n- string\ndate: '2023-11-08'\nslug: groesse02\ntitle: groesse02\n\n---\n\n\n\n\n<!-- WORK IN PROGRESS -->\n\n\n\n\n\n\n\n\n# Aufgabe\n\n\nWir interessieren uns für die typische Körpergröße deutscher Studentis.\n[Hier](https://raw.githubusercontent.com/sebastiansauer/pradadata/master/data-raw/wo_men.csv) findet sich dazu ein Datensatz.\n\nAusgehend von der Annahme, dass sich die Körpergröße normalverteilt (innerhalb eines Geschlechts) suchen wir die Parameter der Normalverteilung, also Mittelwert und Streuung.\n\nGehen wir von folgenden Apriori-Wahrscheinlichkeiten für die Parameter der Normalverteilung aus:\n\n- Mittelwert: 150cm bis 200 cm, jeder Wert gleich plausibel, alle anderen Werte unmöglich\n- SD: 1cm bis 20cm, jeder Wert gleich plausibel, alle anderen Werte unmöglich\n\n\nJa, das sind ziemlich einfältige Annahmen, aber gut, fangen wir damit an.\n\n\nErstellen Sie eine Bayes-Box!\n\nHinweise:\n\n\n- Untersuchen Sie den angegebenen Parameterbereich in 1cm-Schritten.\n- Orientieren Sie sich im Übrigen an den [allgemeinen Hinweisen des Datenwerks](https://datenwerk.netlify.app/hinweise).\n\n\n\n\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n\n# Lösung\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pradadata)  # für den Datensatz `wo_men`\nlibrary(prada)  # für bayesbox, alternativ mit `source`\nlibrary(tidyverse)\nlibrary(ggpubr)\n```\n:::\n\n\nDaten importieren:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(wo_men)\n```\n:::\n\n\n\nMittelwert in der Stichprobe:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwo_men |> \n  group_by(sex) |> \n  summarise(height_avg = mean(height, na.rm = TRUE),\n            height_sd = sd(height, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  sex   height_avg height_sd\n  <chr>      <dbl>     <dbl>\n1 man         183.      9.96\n2 woman       161.     42.8 \n3 <NA>        NaN      NA   \n```\n\n\n:::\n:::\n\n\n\nZur Berechnung der Likelihoods *diskretisieren* wir die stetige Variable `height` in Stufen von jeweils 1cm, der Einfachheit halber.\n\nDie Wahrscheinlichkeit für das 1cm-Intervall um unserem Stichprobenergebnis herem (182.5cm bis 183.5cm), bei z.B. einem Mittelwert von 180cm und einer SD von 10cm, entspricht dann dieser Differenz:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobere_grenze <- pnorm(q = 183 + 0.5, mean = 180, sd = 10)\nuntere_grenze <- pnorm(q = 183 - 0.5, mean = 180, sd = 10)\n\nobere_grenze\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6368307\n```\n\n\n:::\n\n```{.r .cell-code}\nuntere_grenze\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.5987063\n```\n\n\n:::\n\n```{.r .cell-code}\nobere_grenze - untere_grenze\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.03812433\n```\n\n\n:::\n:::\n\n\nVisualisieren wir uns kurz dieses Intervall.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mosaic)\nxpnorm(q = c(182.5, 183.5), mean = 180, sd = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.5987063 0.6368307\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](unnamed-chunk-5-1.png){fig-pos='H' width=384}\n:::\n:::\n\n\n\nAls nächstes legen wir die Werte für unsere Bayes-Box fest.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnorm_mean <- seq(from = 150, to = 200, by = 1)\nnorm_sd <- seq(from = 1, to = 20, by = 1)\n```\n:::\n\n\nJetzt bauen wir unsere Bayes-Box.\n\nWenn wir die Wahrscheinlichkeiten der Parameter für alle Kombinationen aus 51 Mittelwerten und 20 SD-Werten prüfen wollen, wird die Tabelle ganz schön lang:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanzahl_kombinationen <- length(norm_mean) * length(norm_sd)\nanzahl_kombinationen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1020\n```\n\n\n:::\n:::\n\n\n\nMit `expand_grid` kann man sich eine Tabelle erstellen lassen, die alle Kombinationen zweier Variablen aufschreibt:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbayes_box <-\n  expand_grid(norm_mean, norm_sd)\n\nhead(bayes_box)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  norm_mean norm_sd\n      <dbl>   <dbl>\n1       150       1\n2       150       2\n3       150       3\n4       150       4\n5       150       5\n6       150       6\n```\n\n\n:::\n:::\n\n\nDas sind unsere Parameterwerte: Jede Kombination eines Mittelwerts und einer Streuung ist eine Hypothese. Insgesamt haben wir also 1020 Parameterwerte. \n\nSo, bauen wir die Bayes-Box weiter:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nL <- pnorm(183.5, mean = bayes_box$norm_mean, sd = bayes_box$norm_sd)\n\nbayes_box2 <-\n  bayes_box |> \n  mutate(hyp = 1:anzahl_kombinationen,\n         lik = L,\n         post_unstand = hyp * lik,\n         post_std = post_unstand / sum(post_unstand))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples <-\n  bayes_box2 |> \n  slice_sample(\n    n = 1e4,\n    weight_by = post_std,\n    replace = TRUE\n  )\n```\n:::\n\n\nUnd jetzt visualisieren:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamples |> \n  ggplot() +\n  aes(x = norm_sd,\n      y = norm_mean,\n      fill = post_std) +\n  geom_tile() +\n  scale_fill_viridis_c()\n```\n\n::: {.cell-output-display}\n![](unnamed-chunk-11-1.png){fig-pos='H' width=384}\n:::\n:::\n\n\nDie Stichproben-Postverteilung erlaubt es auch bequem, die einzelnen Parameter der Post-Verteilung jeweils für sich zu visualisieren:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngghistogram(samples,\n            x = \"norm_mean\",\n            bins = 15)\n```\n\n::: {.cell-output-display}\n![](unnamed-chunk-12-1.png){fig-pos='H' width=384}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggdensity(samples,\n          x = \"norm_mean\")\n```\n\n::: {.cell-output-display}\n![](unnamed-chunk-13-1.png){fig-pos='H' width=384}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggdensity(samples,\n          x = \"norm_sd\")\n```\n\n::: {.cell-output-display}\n![](unnamed-chunk-14-1.png){fig-pos='H' width=384}\n:::\n:::\n\n\n\n\n\n---\n\nCategories: \nCategories: \n\n- 2023\n- bayes\n- bayes-box\n- string\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}