{
  "hash": "1b2d0ed6c23ad925a70505f2f7ae00d5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate: 2023-12-05 \ndraft: false   # ACHTUNG DRAFT STEHT AUF TRUE!\ntitle: Scikit-Learn-LLM Zero Shot Learners \n\nexecute: \n  eval: true \n  \nhighlight-style: arrow \ncache: true\n\nextype: string\nexsolution: \nexshuffle: no\ncategories:\n- textmining\n- nlp\n- transformer\n- chatgpt\n- sentiment\n- scikit\n\n---\n\n\n\n\n\n\n\n\n\n\n# Aufgabe\n\n\nFragen Sie ChatGPT via [Scikit-Learn-LLM](https://ealizadeh.com/blog/tutorial-scikit-llm/) zum Sentiment der ersten 7 Texte (=Tweets) aus dem Germeval-2018-Datensatz (Test).\nNutzen Sie die gleiche Zahl an Tweets aus dem Train-Datensatz zum Finetuning Ihres Modells.\nNutzen Sie den Endpoint `ZeroShotGPTClassifier`.\n\n\n\n\nHinweise:\n\n- Beachten Sie die [Standardhinweise des Datenwerks](https://datenwerk.netlify.app/hinweise).\n- Nutzen Sie Python, nicht R.\n- Das Verwenden der OpenAI-API kostet Geld. üí∏ Informieren Sie sich vorab. Um auf die API zugreifen zu k√∂nnen, m√ºssen Sie sich ein Konto angelegt haben und √ºber ein Guthaben verf√ºgen. Werfen Sie hin und wieder einen Blick auf Ihr [OpenAI-Guthaben-Konto](https://platform.openai.com/usage).\n\n\n::: {.callout-caution}\nAktuell sind `scikit-llm` und `openai` in den aktuellsten Versionen inkompatibel.\n\n>    ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\nscikit-llm 0.4.2 requires openai<1.0,>=0.27.9, but you have openai 1.3.5 which is incompatible.\n\nDie einfachste L√∂sung ist, beide Pakete in verschiedenen venvs zu lagern. $\\square$\n:::\n\n![sci-llm](scikit-lmm.png){width=33%}\n\n\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n\n# L√∂sung\n\n\nWir legen ggf. eine neue venv an:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-1_3a750b596e3c76fc1e9b4a2fc666848c'}\n\n```{.r .cell-code}\nlibrary(reticulate)\n```\n:::\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-2_1ccc13d081ed9d9db1a1e9f260b1f5c0'}\n\n```{.r .cell-code}\n#virtualenv_create(\"scikit-llm\")\n```\n:::\n\n\nUnd nutzen diese:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/use-venv_4b7b5f3d6772ce6b4da78c8e520b9f5c'}\n\n```{.r .cell-code}\nuse_virtualenv(\"scikit-llm\")\n```\n:::\n\nCheck:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-3_6f1af05240c44f307c10e39bd65c5cb0'}\n\n```{.r .cell-code}\npy_config()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\npython:         /Users/sebastiansaueruser/.virtualenvs/scikit-llm/bin/python\nlibpython:      /Users/sebastiansaueruser/.pyenv/versions/3.11.1/lib/libpython3.11.dylib\npythonhome:     /Users/sebastiansaueruser/.virtualenvs/scikit-llm:/Users/sebastiansaueruser/.virtualenvs/scikit-llm\nversion:        3.11.1 (main, Oct  4 2023, 18:12:06) [Clang 15.0.0 (clang-1500.0.40.1)]\nnumpy:          /Users/sebastiansaueruser/.virtualenvs/scikit-llm/lib/python3.11/site-packages/numpy\nnumpy_version:  1.26.2\n\nNOTE: Python version was forced by use_python() function\n```\n\n\n:::\n:::\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-4_da4344acd18ef9a93f0bff5db20d32a7'}\n\n```{.r .cell-code}\npy_list_packages() |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          package version            requirement\n1         absl-py   1.4.0         absl-py==1.4.0\n2         aiohttp   3.9.0         aiohttp==3.9.0\n3       aiosignal   1.3.1       aiosignal==1.3.1\n4 annotated-types   0.6.0 annotated-types==0.6.0\n5           anyio   3.7.1           anyio==3.7.1\n6    array-record   0.4.0    array-record==0.4.0\n```\n\n\n:::\n:::\n\n\n\n\nGgf. m√ºssen Sie zun√§chst die n√∂tigen Module installieren, z.B. so: `reticulate::py_install(\"scikit-llm\")`.\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-5_d70c5dcd2910f62d26bbb537d056e20c'}\n\n```{.r .cell-code}\n#py_install(\"scikit-llm\")\n```\n:::\n\n\n\n\nModule importieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/import_6d2baf3e37dc5bee5b7d96e8a104564f'}\n\n```{.python .cell-code}\nfrom skllm import ZeroShotGPTClassifier   \nfrom skllm.config import SKLLMConfig  # Anmeldung\nimport pandas as pd\nimport time \nimport os\n```\n:::\n\n\n\n\nTrain-Daten importieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/import-data-train_0bd37b2064599c83c80d0b137ca4d238'}\n\n```{.python .cell-code}\ncsv_file_path_train = 'https://github.com/sebastiansauer/pradadata/raw/master/data-raw/germeval_train.csv'\ngermeval_train = pd.read_csv(csv_file_path_train)\n```\n:::\n\n\nTest-Daten importieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/import-data-test_6ed388744b3ed59fb596c5b0f9514c23'}\n\n```{.python .cell-code}\ncsv_file_path_test = 'https://github.com/sebastiansauer/pradadata/raw/master/data-raw/germeval_test.csv'\ngermeval_test = pd.read_csv(csv_file_path_test)\n```\n:::\n\n\n\n\n\nDie ersten paar Texte aus dem Train-Datensatz herausziehen:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-6_13e08481788ddd428bb6ed63e75f2b11'}\n\n```{.python .cell-code}\nn_tweets = 7\nX_train = germeval_train[\"text\"].head(n_tweets).tolist()\nX_train\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n['@corinnamilborn Liebe Corinna, wir w√ºrden dich gerne als Moderatorin f√ºr uns gewinnen! W√§rst du begeisterbar?', '@Martin28a Sie haben ja auch Recht. Unser Tweet war etwas missverst√§ndlich. Dass das BVerfG Sachleistungen nicht ausschlie√üt, kritisieren wir.', '@ahrens_theo fr√∂hlicher gru√ü aus der sch√∂nsten stadt der welt theo ‚öìÔ∏è', '@dushanwegner Amis h√§tten alles und jeden gew√§hlt...nur Hillary wollten sie nicht und eine Fortsetzung von Obama-Politik erst recht nicht..!', '@spdde kein verl√§√ülicher Verhandlungspartner. Nachkarteln nach den Sondierzngsgespr√§chen - schickt diese St√ºmper #SPD in die Versenkung.', '@Dirki_M Ja, aber wo widersprechen die Zahlen denn denen, die im von uns verlinkten Artikel stehen? In unserem Tweet geht es rein um subs. Gesch√ºtzte. 2017 ist der gesamte Familiennachzug im Vergleich zu 2016 - die Zahlen, die Hr. Brandner bem√ºht - √ºbrigens leicht r√ºckl√§ufig gewesen.', '@milenahanm 33 bis 45 habe ich noch gar nicht gelebt und es geht mir am Arsch vorbei was in dieser Zeit geschehen ist. Ich lebe im heute und jetzt und nicht in der Vergangenheit.']\n```\n\n\n:::\n:::\n\n\nUnd hier sind die Labels dazu:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-7_3f0a61a9c0fcb80bb9af2e7fb081319c'}\n\n```{.python .cell-code}\ny_train = germeval_train[\"c1\"].head(n_tweets).tolist()\ny_train\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n['OTHER', 'OTHER', 'OTHER', 'OTHER', 'OFFENSE', 'OTHER', 'OFFENSE']\n```\n\n\n:::\n:::\n\n\n\nUnd analog f√ºr den Test-Datensatz:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-8_aaa6aa92b3f9a05078cbcab4523d3f12'}\n\n```{.python .cell-code}\nX_test = germeval_test[\"text\"].head(n_tweets).tolist()\n```\n:::\n\n\n\n\nAnmelden bei OpenAI:\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-9_3f0b3eb57aed785da5ae6dabf339116f'}\n\n```{.python .cell-code}\nOPENAI_SECRET_KEY = os.environ.get(\"OPENAI_API_KEY\")\nOPENAI_ORG_ID = os.environ.get(\"OPENAI_ORG_ID\")\n\nSKLLMConfig.set_openai_key(OPENAI_SECRET_KEY)\nSKLLMConfig.set_openai_org(OPENAI_ORG_ID)\n```\n:::\n\n\n\nModel definieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/clf_e64bda2f9f921e383b4192b239ee83a0'}\n\n```{.python .cell-code}\nclf = ZeroShotGPTClassifier(openai_model=\"gpt-3.5-turbo\")\n```\n:::\n\n\n\nModel fitten:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/fit_19ee2c1b4ba153155fc7e185f596d5a8'}\n\n```{.python .cell-code}\nclf.fit(X = X_train, y = y_train)  \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: \"‚ñ∏\";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: \"‚ñæ\";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: \"\";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: \"\";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: \"\";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id=\"sk-container-id-1\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>ZeroShotGPTClassifier()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item\"><div class=\"sk-estimator sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-1\" type=\"checkbox\" checked><label for=\"sk-estimator-id-1\" class=\"sk-toggleable__label sk-toggleable__label-arrow\">ZeroShotGPTClassifier</label><div class=\"sk-toggleable__content\"><pre>ZeroShotGPTClassifier()</pre></div></div></div></div></div>\n```\n\n:::\n:::\n\n\n\nVorhersagen:\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/predict_162b687af869450e4dd4128aa7245c6c'}\n\n```{.python .cell-code}\ny_pred = clf.predict(X = X_test)  \n```\n:::\n\n\n`````\n  0%|          | 0/7 [00:00<?, ?it/s]\n 14%|‚ñà‚ñç        | 1/7 [00:38<03:48, 38.03s/it]\n 29%|‚ñà‚ñà‚ñä       | 2/7 [00:48<01:48, 21.62s/it]\n 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 3/7 [01:16<01:38, 24.65s/it]\n 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 4/7 [01:18<00:47, 15.81s/it]\n 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 5/7 [01:28<00:27, 13.69s/it]\n 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 6/7 [01:31<00:09,  9.87s/it]\n100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [01:33<00:00, 13.32s/it]\n`````\n\n\nVoil√†:\n\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-10_085d54a6ed43a6f7bae9206454dcd3c1'}\n\n```{.python .cell-code}\nfor tweet, sentiment in zip(X_test, y_pred):\n    print(f\"Review: {tweet}\\nPredicted Sentiment: {sentiment}\\n\\n\")\n```\n:::\n\n\n\n````\nReview: Meine Mutter hat mir erz√§hlt, dass mein Vater einen Wahlkreiskandidaten nicht gew√§hlt hat, weil der gegen die Homo-Ehe ist ‚ò∫\nPredicted Sentiment: OFFENSE\n\n\nReview: @Tom174_ @davidbest95 Meine Reaktion; |LBR| Nicht jeder Moslem ist ein Terrorist. Aber jeder Moslem glaubt an √úberlieferungen, die Gewalt und Terror beg√ºnstigen.\nPredicted Sentiment: OFFENSE\n\n\nReview: #Merkel rollt dem Emir von #Katar, der islamistischen Terror unterst√ºtzt, den roten Teppich aus.Wir brauchen einen sofortigen #Waffenstopp!\nPredicted Sentiment: OFFENSE\n\n\nReview: ‚ÄûMerle ist kein junges unschuldiges M√§dchen‚Äú Kch....... üò± #tatort\nPredicted Sentiment: OFFENSE\n\n\nReview: @umweltundaktiv Asylantenflut bringt eben nur negatives f√ºr Deutschland. Drum Asylanenstop und R√ºckf√ºhrung der Mehrzahl.\nPredicted Sentiment: OFFENSE\n\n\nReview: @_StultaMundi Die Bibel enth√§lt ebenfalls Gesetze des Zivil- und Strafrechts.\nPredicted Sentiment: OTHER\n\n\nReview: @Thueringen_ @Miquwarchar @Pontifex_de Man munkelt, Franziskus ist gro√üer \"Kiss\"- und \"Black Sabbath\"-Fan! #RockOn\nPredicted Sentiment: OTHER\n````\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}