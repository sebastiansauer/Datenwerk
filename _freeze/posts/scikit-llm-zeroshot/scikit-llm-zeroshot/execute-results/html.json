{
  "hash": "5919819daccd404887bdadae71d9dea0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate: today\ndraft: TRUE   # ACHTUNG DRAFT STEHT AUF TRUE!\ntitle: Scikit-Learn-LLM Zero Shot Learners \n\nexecute: \n  eval: true \n  \nhighlight-style: arrow \ncache: true\n\nextype: string\nexsolution: \nexshuffle: no\ncategories:\n- textmining\n- nlp\n- transformer\n- chatgpt\n- sentiment\n- scikit\n\n---\n\n\n\n\n\n\n\n\n\n\n# Aufgabe\n\n\nFragen Sie ChatGPT via [Scikit-Learn-LLM](https://ealizadeh.com/blog/tutorial-scikit-llm/) zum Sentiment der ersten 7 Texte (=Tweets) aus dem Germeval-2018-Datensatz (Test).\nNutzen Sie die gleiche Zahl an Tweets aus dem Train-Datensatz zum Finetuning Ihres Modells.\nNutzen Sie den Endpoint `ZeroShotGPTClassifier`.\n\n\n\n\nHinweise:\n\n- Beachten Sie die [Standardhinweise des Datenwerks](https://datenwerk.netlify.app/hinweise).\n- Nutzen Sie Python, nicht R.\n- Das Verwenden der OpenAI-API kostet Geld. üí∏ Informieren Sie sich vorab. Um auf die API zugreifen zu k√∂nnen, m√ºssen Sie sich ein Konto angelegt haben und √ºber ein Guthaben verf√ºgen. Werfen Sie hin und wieder einen Blick auf Ihr [OpenAI-Guthaben-Konto](https://platform.openai.com/usage).\n\n\n::: {.callout-caution}\nAktuell sind `scikit-llm` und `openai` in den aktuellsten Versionen inkompatibel.\n\n>    ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\nscikit-llm 0.4.2 requires openai<1.0,>=0.27.9, but you have openai 1.3.5 which is incompatible.\n\nDie einfachste L√∂sung ist, beide Pakete in verschiedenen venvs zu lagern. $\\square$\n:::\n\n![https://ealizadeh.com/blog/tutorial-scikit-llm/img/_featured_image.png]{width=33%}\n\n\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n\n# L√∂sung\n\n\nWir legen ggf. eine neue venv an:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-1_caeb56a2231b8f0dbfd9555bb6174949'}\n\n```{.r .cell-code}\nlibrary(reticulate)\n```\n:::\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-2_573b6cde35f0208dc95ee3490bb292e6'}\n\n```{.r .cell-code}\n#virtualenv_create(\"scikit-llm\")\n```\n:::\n\n\nUnd nutzen diese:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/use-venv_871791301aea278f3d67dae81c94b3ec'}\n\n```{.r .cell-code}\nuse_virtualenv(\"scikit-llm\")\n```\n:::\n\nCheck:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-3_600217d23f4c4875fadcc1ce3674040c'}\n\n```{.r .cell-code}\npy_config()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\npython:         /Users/sebastiansaueruser/.virtualenvs/scikit-llm/bin/python\nlibpython:      /Users/sebastiansaueruser/.pyenv/versions/3.11.1/lib/libpython3.11.dylib\npythonhome:     /Users/sebastiansaueruser/.virtualenvs/scikit-llm:/Users/sebastiansaueruser/.virtualenvs/scikit-llm\nversion:        3.11.1 (main, Oct  4 2023, 18:12:06) [Clang 15.0.0 (clang-1500.0.40.1)]\nnumpy:          /Users/sebastiansaueruser/.virtualenvs/scikit-llm/lib/python3.11/site-packages/numpy\nnumpy_version:  1.26.2\n\nNOTE: Python version was forced by use_python() function\n```\n\n\n:::\n:::\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-4_9aaeee698976d225fdab9d21f2fffdaf'}\n\n```{.r .cell-code}\npy_list_packages()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                         package      version\n1                        aiohttp        3.9.0\n2                      aiosignal        1.3.1\n3                annotated-types        0.6.0\n4                          anyio        3.7.1\n5                          attrs       23.1.0\n6                     cachetools        5.3.2\n7                        certifi   2023.11.17\n8             charset-normalizer        3.3.2\n9                         distro        1.8.0\n10                    frozenlist        1.4.0\n11               google-api-core       2.14.0\n12                   google-auth       2.23.4\n13       google-cloud-aiplatform       1.36.4\n14         google-cloud-bigquery       3.13.0\n15             google-cloud-core        2.3.3\n16 google-cloud-resource-manager       1.10.4\n17          google-cloud-storage       2.13.0\n18                 google-crc32c        1.5.0\n19        google-resumable-media        2.6.0\n20      googleapis-common-protos       1.61.0\n21            grpc-google-iam-v1       0.12.7\n22                        grpcio       1.59.3\n23                 grpcio-status       1.59.3\n24                           h11       0.14.0\n25                      httpcore        1.0.2\n26                         httpx       0.25.1\n27                          idna          3.4\n28                        joblib        1.3.2\n29                     multidict        6.0.4\n30                         numpy       1.26.2\n31                        openai        1.3.5\n32                     packaging         23.2\n33                        pandas        2.1.3\n34                    proto-plus       1.22.3\n35                      protobuf       4.25.1\n36                        pyasn1        0.5.1\n37                pyasn1-modules        0.3.0\n38                      pydantic        2.5.2\n39                 pydantic_core       2.14.5\n40               python-dateutil        2.8.2\n41                          pytz 2023.3.post1\n42                      requests       2.31.0\n43                           rsa          4.9\n44                  scikit-learn        1.3.2\n45                    scikit-llm        0.4.2\n46                         scipy       1.11.4\n47                       shapely        2.0.2\n48                           six       1.16.0\n49                       sniffio        1.3.0\n50                 threadpoolctl        3.2.0\n51                          tqdm       4.66.1\n52             typing_extensions        4.8.0\n53                        tzdata       2023.3\n54                       urllib3        2.1.0\n55                          yarl        1.9.3\n                             requirement\n1                         aiohttp==3.9.0\n2                       aiosignal==1.3.1\n3                 annotated-types==0.6.0\n4                           anyio==3.7.1\n5                          attrs==23.1.0\n6                      cachetools==5.3.2\n7                    certifi==2023.11.17\n8              charset-normalizer==3.3.2\n9                          distro==1.8.0\n10                     frozenlist==1.4.0\n11               google-api-core==2.14.0\n12                   google-auth==2.23.4\n13       google-cloud-aiplatform==1.36.4\n14         google-cloud-bigquery==3.13.0\n15              google-cloud-core==2.3.3\n16 google-cloud-resource-manager==1.10.4\n17          google-cloud-storage==2.13.0\n18                  google-crc32c==1.5.0\n19         google-resumable-media==2.6.0\n20      googleapis-common-protos==1.61.0\n21            grpc-google-iam-v1==0.12.7\n22                        grpcio==1.59.3\n23                 grpcio-status==1.59.3\n24                           h11==0.14.0\n25                       httpcore==1.0.2\n26                         httpx==0.25.1\n27                             idna==3.4\n28                         joblib==1.3.2\n29                      multidict==6.0.4\n30                         numpy==1.26.2\n31                         openai==1.3.5\n32                       packaging==23.2\n33                         pandas==2.1.3\n34                    proto-plus==1.22.3\n35                      protobuf==4.25.1\n36                         pyasn1==0.5.1\n37                 pyasn1-modules==0.3.0\n38                       pydantic==2.5.2\n39                 pydantic_core==2.14.5\n40                python-dateutil==2.8.2\n41                    pytz==2023.3.post1\n42                      requests==2.31.0\n43                              rsa==4.9\n44                   scikit-learn==1.3.2\n45                     scikit-llm==0.4.2\n46                         scipy==1.11.4\n47                        shapely==2.0.2\n48                           six==1.16.0\n49                        sniffio==1.3.0\n50                  threadpoolctl==3.2.0\n51                          tqdm==4.66.1\n52              typing_extensions==4.8.0\n53                        tzdata==2023.3\n54                        urllib3==2.1.0\n55                           yarl==1.9.3\n```\n\n\n:::\n:::\n\n\n\n\nGgf. m√ºssen Sie zun√§chst die n√∂tigen Module installieren, z.B. so: `reticulate::py_install(\"scikit-llm\")`.\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-5_ab0eff1081959c2185f9fcd3f50a2508'}\n\n```{.r .cell-code}\n#py_install(\"scikit-llm\")\n```\n:::\n\n\n\n\nModule importieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/import_a6fe3918344b8e6ec5fa65b78bd9f0b4'}\n\n```{.python .cell-code}\nfrom skllm import ZeroShotGPTClassifier   \nfrom skllm.config import SKLLMConfig  # Anmeldung\nimport pandas as pd\nimport time \nimport os\n```\n:::\n\n\n\n\nTrain-Daten importieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/import-data-train_de8ea67a70445448293c3458b64910d9'}\n\n```{.python .cell-code}\ncsv_file_path_train = 'https://github.com/sebastiansauer/pradadata/raw/master/data-raw/germeval_train.csv'\ngermeval_train = pd.read_csv(csv_file_path_train)\n```\n:::\n\n\nTest-Daten importieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/import-data-test_4f2c446de0f37db30a6cb034f80d7dfd'}\n\n```{.python .cell-code}\ncsv_file_path_test = 'https://github.com/sebastiansauer/pradadata/raw/master/data-raw/germeval_test.csv'\ngermeval_test = pd.read_csv(csv_file_path_test)\n```\n:::\n\n\n\n\n\nDie ersten paar Texte aus dem Train-Datensatz herausziehen:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-6_be638b571f04eebc53762827e23df970'}\n\n```{.python .cell-code}\nn_tweets = 7\nX_train = germeval_train[\"text\"].head(n_tweets).tolist()\nX_train\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n['@corinnamilborn Liebe Corinna, wir w√ºrden dich gerne als Moderatorin f√ºr uns gewinnen! W√§rst du begeisterbar?', '@Martin28a Sie haben ja auch Recht. Unser Tweet war etwas missverst√§ndlich. Dass das BVerfG Sachleistungen nicht ausschlie√üt, kritisieren wir.', '@ahrens_theo fr√∂hlicher gru√ü aus der sch√∂nsten stadt der welt theo ‚öìÔ∏è', '@dushanwegner Amis h√§tten alles und jeden gew√§hlt...nur Hillary wollten sie nicht und eine Fortsetzung von Obama-Politik erst recht nicht..!', '@spdde kein verl√§√ülicher Verhandlungspartner. Nachkarteln nach den Sondierzngsgespr√§chen - schickt diese St√ºmper #SPD in die Versenkung.', '@Dirki_M Ja, aber wo widersprechen die Zahlen denn denen, die im von uns verlinkten Artikel stehen? In unserem Tweet geht es rein um subs. Gesch√ºtzte. 2017 ist der gesamte Familiennachzug im Vergleich zu 2016 - die Zahlen, die Hr. Brandner bem√ºht - √ºbrigens leicht r√ºckl√§ufig gewesen.', '@milenahanm 33 bis 45 habe ich noch gar nicht gelebt und es geht mir am Arsch vorbei was in dieser Zeit geschehen ist. Ich lebe im heute und jetzt und nicht in der Vergangenheit.']\n```\n\n\n:::\n:::\n\n\nUnd hier sind die Labels dazu:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-7_55b69fccbc59e5498029da4f8918f057'}\n\n```{.python .cell-code}\ny_train = germeval_train[\"c1\"].head(n_tweets).tolist()\ny_train\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n['OTHER', 'OTHER', 'OTHER', 'OTHER', 'OFFENSE', 'OTHER', 'OFFENSE']\n```\n\n\n:::\n:::\n\n\n\nUnd analog f√ºr den Test-Datensatz:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-8_411581766387b600e6452b194e9d55d4'}\n\n```{.python .cell-code}\nX_test = germeval_test[\"text\"].head(n_tweets).tolist()\n```\n:::\n\n\n\n\nAnmelden bei OpenAI:\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-9_262ae4dd2b4bdcae2d70eda9bfdeb8b6'}\n\n```{.python .cell-code}\nOPENAI_SECRET_KEY = os.environ.get(\"OPENAI_API_KEY\")\nOPENAI_ORG_ID = os.environ.get(\"OPENAI_ORG_ID\")\n\nSKLLMConfig.set_openai_key(OPENAI_SECRET_KEY)\nSKLLMConfig.set_openai_org(OPENAI_ORG_ID)\n```\n:::\n\n\n\nModel definieren:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/clf_288cfcfd3db9cd52e0569a2976e257fe'}\n\n```{.python .cell-code}\nclf = ZeroShotGPTClassifier(openai_model=\"gpt-3.5-turbo\")\n```\n:::\n\n\n\nModel fitten:\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/fit_fa6ea6822d6f3e45b1b06b978ebea7ff'}\n\n```{.python .cell-code}\nclf.fit(X = X_train, y = y_train)  \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: \"‚ñ∏\";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: \"‚ñæ\";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: \"\";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: \"\";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: \"\";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id=\"sk-container-id-1\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>ZeroShotGPTClassifier()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item\"><div class=\"sk-estimator sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-1\" type=\"checkbox\" checked><label for=\"sk-estimator-id-1\" class=\"sk-toggleable__label sk-toggleable__label-arrow\">ZeroShotGPTClassifier</label><div class=\"sk-toggleable__content\"><pre>ZeroShotGPTClassifier()</pre></div></div></div></div></div>\n```\n\n:::\n:::\n\n\n\nVorhersagen:\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/predict_b879c0c8ba7f906e56a04b8db57a14fb'}\n\n```{.python .cell-code}\ny_pred = clf.predict(X = X_test)  \n```\n:::\n\n\n`````\n  0%|          | 0/7 [00:00<?, ?it/s]\n 14%|‚ñà‚ñç        | 1/7 [00:38<03:48, 38.03s/it]\n 29%|‚ñà‚ñà‚ñä       | 2/7 [00:48<01:48, 21.62s/it]\n 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 3/7 [01:16<01:38, 24.65s/it]\n 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 4/7 [01:18<00:47, 15.81s/it]\n 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 5/7 [01:28<00:27, 13.69s/it]\n 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 6/7 [01:31<00:09,  9.87s/it]\n100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 7/7 [01:33<00:00, 13.32s/it]\n`````\n\n\nVoil√†:\n\n\n\n\n::: {.cell hash='scikit-llm-zeroshot_cache/html/unnamed-chunk-10_d4608df0f1b0494c1d06a899306ebb67'}\n\n```{.python .cell-code}\nfor tweet, sentiment in zip(X_test, y_pred):\n    print(f\"Review: {tweet}\\nPredicted Sentiment: {sentiment}\\n\\n\")\n```\n:::\n\n\n\n````\nReview: Meine Mutter hat mir erz√§hlt, dass mein Vater einen Wahlkreiskandidaten nicht gew√§hlt hat, weil der gegen die Homo-Ehe ist ‚ò∫\nPredicted Sentiment: OFFENSE\n\n\nReview: @Tom174_ @davidbest95 Meine Reaktion; |LBR| Nicht jeder Moslem ist ein Terrorist. Aber jeder Moslem glaubt an √úberlieferungen, die Gewalt und Terror beg√ºnstigen.\nPredicted Sentiment: OFFENSE\n\n\nReview: #Merkel rollt dem Emir von #Katar, der islamistischen Terror unterst√ºtzt, den roten Teppich aus.Wir brauchen einen sofortigen #Waffenstopp!\nPredicted Sentiment: OFFENSE\n\n\nReview: ‚ÄûMerle ist kein junges unschuldiges M√§dchen‚Äú Kch....... üò± #tatort\nPredicted Sentiment: OFFENSE\n\n\nReview: @umweltundaktiv Asylantenflut bringt eben nur negatives f√ºr Deutschland. Drum Asylanenstop und R√ºckf√ºhrung der Mehrzahl.\nPredicted Sentiment: OFFENSE\n\n\nReview: @_StultaMundi Die Bibel enth√§lt ebenfalls Gesetze des Zivil- und Strafrechts.\nPredicted Sentiment: OTHER\n\n\nReview: @Thueringen_ @Miquwarchar @Pontifex_de Man munkelt, Franziskus ist gro√üer \"Kiss\"- und \"Black Sabbath\"-Fan! #RockOn\nPredicted Sentiment: OTHER\n````\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}