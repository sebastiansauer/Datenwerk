{
  "hash": "5a529d8712d567501ee0991fbdb0c1c6",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexname: within-design-analysis1\nexpoints: 1\nextype: string\nexsolution: NA\ncategories:\n- regression\n- within-design\n- researchdesign\n- fopro\n- string\ndate: '2023-11-08'\nslug: within-design-analysis1\ntitle: within-design-analysis1\n\n---\n\n\n\n\n\n# Aufgabe\n\nAnalysieren Sie die Veränderung in einem längsschnittlichen Experiment (Within-Design).\n\nIm Zuge des Experiments durchliefen alle $n$ Versuchspersonen 3 Bedingungen.\nEntsprechend liegen für jede Versuchsperson 3 Messungen vor (y1, y2, y3).\nAnders gesagt gab es drei Messzeitpunkte (t1, t2, t3),\nzu denen die abhängige Variable (y) jeweils gemessen wurde\nDie Messung bestand bei jeder Bedingung aus 10 Items,\nwobei die Wahrscheinlichkeit, ein Item zu lösen zwischen den Bedingungen unterschiedlich war.\n\nPrüfen Sie die folgende Hypothesen:\n\n1. $y_{t2} - y_{t1} > 0$\n2. $y_{t3} - y_{t2} > 0$\n\n\nGehen Sie von folgenden (hier einfach simulierten) Daten aus:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 40  # Anzahl Versuchspersonen\nn_items <- 10  # Anzahl Items pro Messung von y\nprob <- c(.5, .7, .9)  # Lösungswahrscheinlichkeit pro Messzeitpunkt (t1, t2, t3)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nset.seed(42)\nd <-\n  tibble(id = 1:n,\n         y1 = rbinom(n = n, size = n_items, prob = prob[1]),\n         y2 = rbinom(n = n, size = n_items, prob = prob[2]),\n         y3 = rbinom(n = n, size = n_items, prob = prob[3]),\n         g = c(rep(times = n/2, x = \"A\"), rep(times = n/2, x = \"B\"))\n         )\nhead(d)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n     id    y1    y2    y3 g    \n  <int> <int> <int> <int> <chr>\n1     1     7     8     9 A    \n2     2     7     7    10 A    \n3     3     4     9     9 A    \n4     4     7     4     9 A    \n5     5     6     7     8 A    \n6     6     5     4     9 A    \n```\n\n\n:::\n:::\n\n\n\nHinweise:\n\n- Orientieren Sie sich im Übrigen an den [allgemeinen Hinweisen des Datenwerks](https://datenwerk.netlify.app/hinweise).\n\n\n\n\n\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n</br>\n\n# Lösung\n\n\n## Pakete starten\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rstanarm)\nlibrary(easystats)\n```\n:::\n\n\n## Daten aufbereiten\n\nUm die Daten (besser) analysieren zu können, formen wir sie ins \"lange Format\" um.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_long <-\n  d %>% \n  pivot_longer(cols = c(y1, y2, y3), names_to = \"time\", values_to = \"y\")\n```\n:::\n\n\n\n## Daten zusammenfassen\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_long %>% \n  group_by(time) %>% \n  summarise(y_mean = mean(y),\n            y_sd = sd(y)) %>% \n  mutate(delta = y_mean - lag(y_mean))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  time  y_mean  y_sd delta\n  <chr>  <dbl> <dbl> <dbl>\n1 y1      5.45 1.74  NA   \n2 y2      7.05 1.55   1.6 \n3 y3      8.98 0.891  1.92\n```\n\n\n:::\n:::\n\n\n## Daten visualisieren\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_long %>% \n  ggplot(aes(x = time, y = y)) +\n  geom_jitter(width = .1) +\n  stat_summary(fun.y = mean, geom = \"point\", color = \"red\", size = 3) +\n  stat_summary(fun.y = mean, geom = \"line\", color = \"red\", linewidth = 1, group = 1) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `fun.y` argument of `stat_summary()` is deprecated as of ggplot2 3.3.0.\nℹ Please use the `fun` argument instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](within-design-analysis1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nMan sieht, dass der Wert von Y steigt von t1 zu t2 und genauso von t2 zu t3.\n\n## Daten transformieren\n\nMan kann auch die Veränderung (das \"delta\") zwischen den Messzeitpunkten berechnen,\num dann zu prüfen, ob dieses delta dann positiv ist.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd2 <-\n  d %>% \n  mutate(t2mt1 = y2 - y1,  # t2 *m*inus t1\n         t3mt2 = y3 - y2,  # t3 minus t2\n         t3mt1 = y3 - y1)  # t3 mind t1, die Gesamtveränderung von \"Anfang\" zu \"Ende\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nd2_long <- \n  d2 %>% \n  pivot_longer(cols = c(t2mt1, t3mt2, t3mt1), names_to = \"time\", values_to = \"delta\")\n```\n:::\n\n\n## Daten zusammenfassen\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd2_long %>% \n  group_by(time) %>% \n  summarise(delta_mean = mean(delta),\n            delta_sd = sd(delta)) %>% \n  mutate(delta2 = delta_mean - lag(delta_mean))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  time  delta_mean delta_sd delta2\n  <chr>      <dbl>    <dbl>  <dbl>\n1 t2mt1       1.6      2.63  NA   \n2 t3mt1       3.52     1.78   1.92\n3 t3mt2       1.92     1.97  -1.6 \n```\n\n\n:::\n:::\n\n\nWie man sieht, ist das Delta t2mt1 positiv, im Mittelwert steigt also y. \nGleiches gilt für t3mt2 und t3mt1.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd2_long %>% \n  filter(time != \"t3mt1\") %>% \n  ggplot(aes(x = time, y = delta)) +\n  geom_jitter(width = .1) +\n  stat_summary(fun.y = mean, geom = \"point\", color = \"red\", size = 3) +\n  stat_summary(fun.y = mean, geom = \"line\", color = \"red\", linewidth = 1, group = 1) \n```\n\n::: {.cell-output-display}\n![](within-design-analysis1_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nDie Veränderungen von t1 zu t2 (t2mt1) sind ähnlich zu denen von t2 zu t3 (t3mt2).\n\n\n## Modell t2mt1\n\nDas entsprechende Regressionsmodell für t2mt2 liefert einfach den Mittelwert des Deltas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_t2mt1 <- lm(t2mt1 ~ 1, data = d2)\ncoef(m1_t2mt1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept) \n        1.6 \n```\n\n\n:::\n:::\n\n\n\nEin Bayes-Modell hat den Vorteil, dass es uns einfach zu interpretierende Inferenzstatistik gibt.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_bayes <- stan_glm(t2mt1 ~ 1, data = d2, refresh = 0)\ncoef(m1_bayes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept) \n   1.602565 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nparameters(m1_bayes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Median |       95% CI |     pd |  Rhat |     ESS |                 Prior\n--------------------------------------------------------------------------------------\n(Intercept) |   1.60 | [0.77, 2.47] | 99.95% | 1.000 | 2449.00 | Normal (1.60 +- 6.57)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nUncertainty intervals (equal-tailed) and p-values (two-tailed) computed\n  using a MCMC distribution approximation.\n```\n\n\n:::\n:::\n\nMit einer Wahrscheinlichkeit von 100% ist das Delta positiv (laut `m1_bayes`).\nDas kann man aus dem Koeffizienten `pd` ablesen (probability of direction).\n\n\n## m_t3mt2\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_t3mt2_bayes <- stan_glm(t3mt2 ~ 1, data = d2, refresh = 0)\nparameters(m_t3mt2_bayes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Median |       95% CI |   pd |  Rhat |     ESS |                 Prior\n------------------------------------------------------------------------------------\n(Intercept) |   1.93 | [1.32, 2.53] | 100% | 1.001 | 2753.00 | Normal (1.93 +- 4.92)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nUncertainty intervals (equal-tailed) and p-values (two-tailed) computed\n  using a MCMC distribution approximation.\n```\n\n\n:::\n:::\n\n\nAuch hier ist das Modell sehr meinungsstark: \nMit einer Wahrscheinlichkeit von 100% ist der Koeffizient (Veränderung von t2 zu t3) positiv.\n\n\n\n\n---\n\nCategories: \n\n- regression\n- within-design\n- researchdesign\n- fopro\n- string\n\n",
    "supporting": [
      "within-design-analysis1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}