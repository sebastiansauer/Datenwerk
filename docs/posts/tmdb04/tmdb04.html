<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-05-17">

<title>tmdb04 – datenwerk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-36228135ecc5ef07794e934de038b4b3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">datenwerk</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Ans Werk, Daten!</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Hinweise.html"> 
<span class="menu-text">Hinweise</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../English.html"> 
<span class="menu-text">English</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sebastiansauer/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">tmdb04</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">ds1</div>
    <div class="quarto-category">tidymodels</div>
    <div class="quarto-category">statlearning</div>
    <div class="quarto-category">tmdb</div>
    <div class="quarto-category">random-forest</div>
    <div class="quarto-category">num</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 17, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="aufgabe" class="level1">
<h1>Aufgabe</h1>
<p>Wir bearbeiten hier die Fallstudie <a href="https://www.kaggle.com/competitions/tmdb-box-office-prediction/overview">TMDB Box Office Prediction - Can you predict a movie’s worldwide box office revenue?</a>, ein <a href="https://www.kaggle.com/">Kaggle</a>-Prognosewettbewerb.</p>
<p>Ziel ist es, genaue Vorhersagen zu machen, in diesem Fall für Filme.</p>
<p>Die Daten können Sie von der Kaggle-Projektseite beziehen oder so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>d_train_path <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/train.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>d_test_path <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/test.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aufgabe-1" class="level1">
<h1>Aufgabe</h1>
<p>Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Score!</p>
<p>Hinweise:</p>
<ul>
<li>Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden.</li>
<li>Halten Sie das Modell so <em>einfach</em> wie möglich. Verwenden Sie als Algorithmus die <em>lineare Regression</em> ohne weitere Schnörkel.</li>
<li>Logarithmieren Sie <code>budget</code> und <code>revenue</code>.</li>
<li>Minimieren Sie die Vorverarbeitung (<code>steps</code>) so weit als möglich.</li>
<li>Verwenden Sie <code>tidymodels</code>.</li>
<li>Die Zielgröße ist <code>revenue</code> in Dollars; nicht in “Log-Dollars”. Sie müssen also rücktransformieren, wenn Sie <code>revenue</code> logarithmiert haben, bevor Sie Ihre Prognose einreichen.</li>
</ul>
<p><br> <br> <br> <br> <br> <br> <br> <br> <br> <br></p>
</section>
<section id="lösung" class="level1">
<h1>Lösung</h1>
</section>
<section id="vorbereitung" class="level1">
<h1>Vorbereitung</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(finetune)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>d_train_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(d_train_path)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>d_test_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(d_test_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sicher ist sicher:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>d_train_backup <span class="ot">&lt;-</span> d_train_raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mal einen Blick werfen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d_train_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,000
Columns: 23
$ id                    &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1…
$ belongs_to_collection &lt;chr&gt; "[{'id': 313576, 'name': 'Hot Tub Time Machine C…
$ budget                &lt;dbl&gt; 1.40e+07, 4.00e+07, 3.30e+06, 1.20e+06, 0.00e+00…
$ genres                &lt;chr&gt; "[{'id': 35, 'name': 'Comedy'}]", "[{'id': 35, '…
$ homepage              &lt;chr&gt; NA, NA, "http://sonyclassics.com/whiplash/", "ht…
$ imdb_id               &lt;chr&gt; "tt2637294", "tt0368933", "tt2582802", "tt182148…
$ original_language     &lt;chr&gt; "en", "en", "en", "hi", "ko", "en", "en", "en", …
$ original_title        &lt;chr&gt; "Hot Tub Time Machine 2", "The Princess Diaries …
$ overview              &lt;chr&gt; "When Lou, who has become the \"father of the In…
$ popularity            &lt;dbl&gt; 6.575393, 8.248895, 64.299990, 3.174936, 1.14807…
$ poster_path           &lt;chr&gt; "/tQtWuwvMf0hCc2QR2tkolwl7c3c.jpg", "/w9Z7A0GHEh…
$ production_companies  &lt;chr&gt; "[{'name': 'Paramount Pictures', 'id': 4}, {'nam…
$ production_countries  &lt;chr&gt; "[{'iso_3166_1': 'US', 'name': 'United States of…
$ release_date          &lt;chr&gt; "2/20/15", "8/6/04", "10/10/14", "3/9/12", "2/5/…
$ runtime               &lt;dbl&gt; 93, 113, 105, 122, 118, 83, 92, 84, 100, 91, 119…
$ spoken_languages      &lt;chr&gt; "[{'iso_639_1': 'en', 'name': 'English'}]", "[{'…
$ status                &lt;chr&gt; "Released", "Released", "Released", "Released", …
$ tagline               &lt;chr&gt; "The Laws of Space and Time are About to be Viol…
$ title                 &lt;chr&gt; "Hot Tub Time Machine 2", "The Princess Diaries …
$ Keywords              &lt;chr&gt; "[{'id': 4379, 'name': 'time travel'}, {'id': 96…
$ cast                  &lt;chr&gt; "[{'cast_id': 4, 'character': 'Lou', 'credit_id'…
$ crew                  &lt;chr&gt; "[{'credit_id': '59ac067c92514107af02c8c8', 'dep…
$ revenue               &lt;dbl&gt; 12314651, 95149435, 13092000, 16000000, 3923970,…</code></pre>
</div>
</div>
<section id="train-set-verschlanken" class="level2">
<h2 class="anchored" data-anchor-id="train-set-verschlanken">Train-Set verschlanken</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>d_train_raw_reduced <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  d_train_raw <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, popularity, runtime, revenue, budget) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-set-verschlanken" class="level2">
<h2 class="anchored" data-anchor-id="test-set-verschlanken">Test-Set verschlanken</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d_test <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  d_test_raw <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id,popularity, runtime, budget) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="outcome-logarithmieren" class="level2">
<h2 class="anchored" data-anchor-id="outcome-logarithmieren">Outcome logarithmieren</h2>
<p>Der Outcome <a href="https://github.com/topepo/nyr-2020">sollte <em>nicht</em> im Rezept transformiert werden (vgl. Part 3, S. 30, in dieser Unterlage)</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>d_train <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  d_train_raw_reduced <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue =</span> <span class="fu">if_else</span>(revenue <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="dv">10</span>, revenue)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue =</span> <span class="fu">log</span>(revenue)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Prüfen, ob das funktioniert hat:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>d_train<span class="sc">$</span>revenue <span class="sc">%&gt;%</span> <span class="fu">is.infinite</span>() <span class="sc">%&gt;%</span> <span class="fu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>Keine unendlichen Werte mehr, auf dieser Basis können wir weitermachen.</p>
</section>
</section>
<section id="fehlende-werte-prüfen" class="level1">
<h1>Fehlende Werte prüfen</h1>
<p>Welche Spalten haben viele fehlende Werte?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_distribution</span>(d_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variable   |     Mean |       SD |      IQR |              Range | Skewness | Kurtosis |    n | n_Missing
---------------------------------------------------------------------------------------------------------
id         |  1500.50 |   866.17 |  1500.50 |    [1.00, 3000.00] |     0.00 |    -1.20 | 3000 |         0
popularity |     8.46 |    12.10 |     6.88 | [1.00e-06, 294.34] |    14.38 |   280.10 | 3000 |         0
runtime    |   107.86 |    22.09 |    24.00 |     [0.00, 338.00] |     1.02 |     8.19 | 2998 |         2
revenue    |    15.97 |     3.04 |     3.37 |      [2.30, 21.14] |    -1.60 |     3.82 | 3000 |         0
budget     | 2.25e+07 | 3.70e+07 | 2.90e+07 |   [0.00, 3.80e+08] |     3.10 |    13.23 | 3000 |         0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sum_isna <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">sum</span>(<span class="fu">is.na</span>(x))}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>d_train <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum_isna))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
     id popularity runtime revenue budget
  &lt;int&gt;      &lt;int&gt;   &lt;int&gt;   &lt;int&gt;  &lt;int&gt;
1     0          0       2       0      0</code></pre>
</div>
</div>
</section>
<section id="rezept" class="level1">
<h1>Rezept</h1>
<section id="rezept-definieren" class="level2">
<h2 class="anchored" data-anchor-id="rezept-definieren">Rezept definieren</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rec2 <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(revenue <span class="sc">~</span> ., <span class="at">data =</span> d_train) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">budget =</span> <span class="fu">ifelse</span>(budget <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, budget)) <span class="sc">%&gt;%</span>  <span class="co"># log mag keine 0</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_log</span>(budget) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())  <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>rec2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Schauen Sie mal, der Log mag keine Nullen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">0</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0000000 0.6931472        NA      -Inf</code></pre>
</div>
</div>
<p>Da <span class="math inline">\(log(0) = -\infty\)</span>. Aus dem Grund wandeln wir 0 lieber in <code>NA</code> um.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(rec2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  number operation type       trained skip  id              
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;      &lt;lgl&gt;   &lt;lgl&gt; &lt;chr&gt;           
1      1 step      mutate     FALSE   FALSE mutate_5IvPK    
2      2 step      log        FALSE   FALSE log_HuvzM       
3      3 step      impute_knn FALSE   FALSE impute_knn_bzUap
4      4 step      dummy      FALSE   FALSE dummy_Gm3kh     </code></pre>
</div>
</div>
</section>
<section id="check-das-rezept" class="level2">
<h2 class="anchored" data-anchor-id="check-das-rezept">Check das Rezept</h2>
<p>Wir berechnen das Rezept:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>rec2_prepped <span class="ot">&lt;-</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(rec2, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>oper 1 step mutate [training] 
oper 2 step log [training] 
oper 3 step impute knn [training] 
oper 4 step dummy [training] 
The retained training set is ~ 0.12 Mb  in memory.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rec2_prepped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das ist noch <em>nicht</em> auf einen Datensatz angewendet! Lediglich die <code>steps</code> wurden <em>vorbereitet</em>, “präpariert”: z.B. “Diese Dummy-Variablen impliziert das Rezept”.</p>
<p>So sieht das dann aus, wenn man das <em>präparierte</em> Rezept auf das Train-Sample anwendet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>d_train_baked2 <span class="ot">&lt;-</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  rec2_prepped <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>) </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d_train_baked2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
     id popularity runtime budget revenue
  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1     1      6.58       93   16.5    16.3
2     2      8.25      113   17.5    18.4
3     3     64.3       105   15.0    16.4
4     4      3.17      122   14.0    16.6
5     5      1.15      118   15.8    15.2
6     6      0.743      83   15.9    15.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>d_train_baked2 <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(sum_isna)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
     id popularity runtime budget revenue
  &lt;int&gt;      &lt;int&gt;   &lt;int&gt;  &lt;int&gt;   &lt;int&gt;
1     0          0       0      0       0</code></pre>
</div>
</div>
<p>Keine fehlenden Werte mehr <em>in den Prädiktoren</em>.</p>
<p>Nach fehlenden Werten könnte man z.B. auch so suchen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>datawizard<span class="sc">::</span><span class="fu">describe_distribution</span>(d_train_baked2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variable   |    Mean |     SD |     IQR |              Range | Skewness | Kurtosis |    n | n_Missing
-----------------------------------------------------------------------------------------------------
id         | 1500.50 | 866.17 | 1500.50 |    [1.00, 3000.00] |     0.00 |    -1.20 | 3000 |         0
popularity |    8.46 |  12.10 |    6.88 | [1.00e-06, 294.34] |    14.38 |   280.10 | 3000 |         0
runtime    |  107.85 |  22.08 |   24.00 |     [0.00, 338.00] |     1.02 |     8.20 | 3000 |         0
budget     |   16.09 |   1.89 |    1.90 |      [0.00, 19.76] |    -2.93 |    18.71 | 3000 |         0
revenue    |   15.97 |   3.04 |    3.37 |      [2.30, 21.14] |    -1.60 |     3.82 | 3000 |         0</code></pre>
</div>
</div>
<p>So bekommt man gleich noch ein paar Infos über die Verteilung der Variablen. Praktische Sache.</p>
</section>
<section id="check-test-sample" class="level2">
<h2 class="anchored" data-anchor-id="check-test-sample">Check Test-Sample</h2>
<p>Das Test-Sample backen wir auch mal, um zu prüfen, das alles läuft:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>d_test_baked2 <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(rec2_prepped, <span class="at">new_data =</span> d_test)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>d_test_baked2 <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
     id popularity runtime budget
  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1  3001       3.85      90   15.8
2  3002       3.56      65   11.4
3  3003       8.09     100   16.4
4  3004       8.60     130   15.7
5  3005       3.22      92   14.5
6  3006       8.68     121   16.1</code></pre>
</div>
</div>
<p>Sieht soweit gut aus.</p>
</section>
</section>
<section id="kreuzvalidierung-resampling" class="level1">
<h1>Kreuzvalidierung / Resampling</h1>
<p>Hier ist <em>nur</em> aus Gründen der Rechenzeit auf kleine Werte von <span class="math inline">\(v\)</span> und <span class="math inline">\(r\)</span> ausgewichen worden. Besser wäre z.B. <span class="math inline">\(v=10\)</span> und <span class="math inline">\(r=3\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>cv_scheme <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(d_train,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">v =</span> <span class="dv">3</span>, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">repeats =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelle" class="level1">
<h1>Modelle</h1>
<section id="lm" class="level2">
<h2 class="anchored" data-anchor-id="lm">LM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mod_lm <span class="ot">&lt;-</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="workflow-set" class="level1">
<h1>Workflow-Set</h1>
<p>Hier nur ein sehr kleiner Workflow-Set.</p>
<p>Das ist übrigens eine gute Strategie: Erstmal mit einem kleinen Prozess anfangen, und dann sukzessive erweitern.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>preproc2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">rec1 =</span> rec2)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>models2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">lm1 =</span> mod_lm)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>all_workflows2 <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(preproc2, models2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitten-und-tunen" class="level1">
<h1>Fitten und tunen</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tmdb_model_set2 <span class="ot">&lt;-</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    all_workflows2 <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">workflow_map</span>(<span class="at">resamples =</span> cv_scheme,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fn =</span> <span class="st">"tune_race_anova"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finalisieren" class="level1">
<h1>Finalisieren</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tmdb_model_set2 <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>mean) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 9
  wflow_id .config          preproc model .metric .estimator  mean     n std_err
  &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 rec1_lm1 Preprocessor1_M… recipe  line… rmse    standard   2.46      3  0.119 
2 rec1_lm1 Preprocessor1_M… recipe  line… rsq     standard   0.349     3  0.0326</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>best_model_params2 <span class="ot">&lt;-</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_workflow_set_result</span>(tmdb_model_set2, <span class="st">"rec1_lm1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: No value of `metric` was given; metric 'rmse' will be used.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>best_model_params2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  .config             
  &lt;chr&gt;               
1 Preprocessor1_Model1</code></pre>
</div>
</div>
<section id="finalisieren-1" class="level2">
<h2 class="anchored" data-anchor-id="finalisieren-1">Finalisieren</h2>
<p>Finalisieren bedeutet:</p>
<ul>
<li>Besten Workflow identifizieren (zur Erinnerung: Workflow = Rezept + Modell)</li>
<li>Den besten Workflow mit den optimalen Modell-Parametern ausstatten</li>
<li>Damit dann den ganzen Train-Datensatz fitten</li>
<li>Auf dieser Basis das Test-Sample vorhersagen</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>best_wf2 <span class="ot">&lt;-</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>all_workflows2 <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">"rec1_lm1"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>best_wf2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_log()
• step_impute_knn()
• step_dummy()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>best_wf_finalized2 <span class="ot">&lt;-</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  best_wf2 <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_model_params2)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>best_wf_finalized2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_log()
• step_impute_knn()
• step_dummy()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
</section>
<section id="final-fit" class="level2">
<h2 class="anchored" data-anchor-id="final-fit">Final Fit</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fit_final2 <span class="ot">&lt;-</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  best_wf_finalized2 <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(d_train)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>fit_final2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_log()
• step_impute_knn()
• step_dummy()

── Model ───────────────────────────────────────────────────────────────────────

Call:
stats::lm(formula = ..y ~ ., data = data)

Coefficients:
(Intercept)   popularity      runtime       budget  
    1.26186      0.03755      0.01289      0.80752  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>fit_final2 <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> d_test)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  .pred
  &lt;dbl&gt;
1  15.3
2  11.4
3  16.1
4  16.0
5  14.3
6  16.1</code></pre>
</div>
</div>
<p>Achtung, wenn die Outcome-Variable im Rezept verändert wurde, dann würde obiger Code <em>nicht</em> durchlaufen.</p>
<p>Grund ist <a href="https://github.com/tidymodels/workflows/issues/63">hier</a> beschrieben:</p>
<blockquote class="blockquote">
<p>When predict() is used, it only has access to the predictors (mirroring how this would work with new samples). Even if the outcome column is present, it is not exposed to the recipe. This is generally a good idea so that we can avoid information leakage.</p>
</blockquote>
<blockquote class="blockquote">
<p>One approach is the use the skip = TRUE option in step_log() so that it will avoid that step during predict() and/or bake(). However, if you are using this recipe with the tune package, there will still be an issue because the metric function(s) would get the predictions in log units and the observed outcome in the original units.</p>
</blockquote>
<blockquote class="blockquote">
<p>The better approach is, for simple transformations like yours, to log the outcome outside of the recipe (before data analysis and the initial split).</p>
</blockquote>
</section>
<section id="submission-df" class="level2">
<h2 class="anchored" data-anchor-id="submission-df">Submission df</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>submission_df <span class="ot">&lt;-</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  d_test <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(preds) <span class="sc">%&gt;%</span> </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">revenue =</span> .pred)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(submission_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
     id revenue
  &lt;dbl&gt;   &lt;dbl&gt;
1  3001    15.3
2  3002    11.4
3  3003    16.1
4  3004    16.0
5  3005    14.3
6  3006    16.1</code></pre>
</div>
</div>
</section>
<section id="zurücktransformieren" class="level2">
<h2 class="anchored" data-anchor-id="zurücktransformieren">Zurücktransformieren</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>submission_df <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  submission_df <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue =</span> <span class="fu">exp</span>(revenue)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(submission_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
     id   revenue
  &lt;dbl&gt;     &lt;dbl&gt;
1  3001  4435143.
2  3002    91755.
3  3003  9782986.
4  3004  8573795.
5  3005  1598106.
6  3006 10061439.</code></pre>
</div>
</div>
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.expm1.html">Hier</a> ein Beispiel, warum <span class="math inline">\(e^x-1\)</span> genauer ist für kleine Zahlen als <span class="math inline">\(e^x\)</span>.</p>
<p>Abspeichern und einreichen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(submission_df, <span class="at">file =</span> <span class="st">"submission.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="kaggle-score" class="level1">
<h1>Kaggle Score</h1>
<p>Diese Submission erzielte einen Score von <strong>Score: 2.46249</strong> (RMSLE).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>sol <span class="ot">&lt;-</span> <span class="fl">2.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Categories:</p>
<ul>
<li>ds1</li>
<li>tidymodels</li>
<li>statlearning</li>
<li>tmdb</li>
<li>random-forest</li>
<li>num</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb57" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="an">exname:</span><span class="co"> tmdb04</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="an">extype:</span><span class="co"> num</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="an">exsolution:</span><span class="co"> r sol</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="an">extol:</span><span class="co"> 0.2</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="an">expoints:</span><span class="co"> 1</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">- ds1</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">- tidymodels</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">- statlearning</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">- tmdb</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">- random-forest</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">- num</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> '2023-05-17'</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="an">slug:</span><span class="co"> tmdb04</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> tmdb04</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libs, include = FALSE}</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r global-knitr-options, include=FALSE}</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.pos =</span> <span class="st">'H'</span>,</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fig.asp =</span> <span class="fl">0.618</span>,</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fig.width =</span> <span class="dv">4</span>,</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fig.cap =</span> <span class="st">""</span>, </span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fig.path =</span> <span class="st">""</span>,</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fig.show =</span> <span class="st">"hold"</span>)</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a><span class="fu"># Aufgabe</span></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>Wir bearbeiten hier die Fallstudie [TMDB Box Office Prediction - </span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>Can you predict a movie's worldwide box office revenue?](https://www.kaggle.com/competitions/tmdb-box-office-prediction/overview),</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>ein <span class="co">[</span><span class="ot">Kaggle</span><span class="co">](https://www.kaggle.com/)</span>-Prognosewettbewerb.</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>Ziel ist es, genaue Vorhersagen zu machen,</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>in diesem Fall für Filme.</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>Die Daten können Sie von der Kaggle-Projektseite beziehen oder so:</span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>d_train_path <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/train.csv"</span></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>d_test_path <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/test.csv"</span></span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a><span class="fu"># Aufgabe</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Score!</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>Hinweise:</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden.</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Halten Sie das Modell so *einfach* wie möglich. Verwenden Sie als Algorithmus die *lineare Regression* ohne weitere Schnörkel.</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Logarithmieren Sie <span class="in">`budget`</span> und <span class="in">`revenue`</span>.</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Minimieren Sie die Vorverarbeitung (<span class="in">`steps`</span>) so weit als möglich.</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verwenden Sie <span class="in">`tidymodels`</span>.</span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Die Zielgröße ist <span class="in">`revenue`</span> in Dollars; nicht in "Log-Dollars". Sie müssen also rücktransformieren,</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>wenn Sie <span class="in">`revenue`</span> logarithmiert haben, bevor Sie Ihre Prognose einreichen.</span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a><span class="fu"># Lösung</span></span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a><span class="fu"># Vorbereitung</span></span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(finetune)</span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>d_train_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(d_train_path)</span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a>d_test_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(d_test_path)</span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>Sicher ist sicher:</span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>d_train_backup <span class="ot">&lt;-</span> d_train_raw</span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a>Mal einen Blick werfen:</span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d_train_raw)</span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a><span class="fu">## Train-Set verschlanken</span></span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>d_train_raw_reduced <span class="ot">&lt;-</span></span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>  d_train_raw <span class="sc">%&gt;%</span> </span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, popularity, runtime, revenue, budget) </span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test-Set verschlanken</span></span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a>d_test <span class="ot">&lt;-</span></span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a>  d_test_raw <span class="sc">%&gt;%</span> </span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id,popularity, runtime, budget) </span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a><span class="fu">## Outcome logarithmieren</span></span>
<span id="cb57-164"><a href="#cb57-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-165"><a href="#cb57-165" aria-hidden="true" tabindex="-1"></a>Der Outcome <span class="co">[</span><span class="ot">sollte *nicht* im Rezept transformiert werden (vgl. Part 3, S. 30, in dieser Unterlage)</span><span class="co">](https://github.com/topepo/nyr-2020)</span>.</span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a>d_train <span class="ot">&lt;-</span></span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a>  d_train_raw_reduced <span class="sc">%&gt;%</span> </span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue =</span> <span class="fu">if_else</span>(revenue <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="dv">10</span>, revenue)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue =</span> <span class="fu">log</span>(revenue)) </span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-175"><a href="#cb57-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-176"><a href="#cb57-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-177"><a href="#cb57-177" aria-hidden="true" tabindex="-1"></a>Prüfen, ob das funktioniert hat:</span>
<span id="cb57-178"><a href="#cb57-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-179"><a href="#cb57-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-182"><a href="#cb57-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-183"><a href="#cb57-183" aria-hidden="true" tabindex="-1"></a>d_train<span class="sc">$</span>revenue <span class="sc">%&gt;%</span> <span class="fu">is.infinite</span>() <span class="sc">%&gt;%</span> <span class="fu">any</span>()</span>
<span id="cb57-184"><a href="#cb57-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-185"><a href="#cb57-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-186"><a href="#cb57-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-187"><a href="#cb57-187" aria-hidden="true" tabindex="-1"></a>Keine unendlichen Werte mehr, auf dieser Basis können wir weitermachen.</span>
<span id="cb57-188"><a href="#cb57-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-189"><a href="#cb57-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-190"><a href="#cb57-190" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fehlende Werte prüfen</span></span>
<span id="cb57-191"><a href="#cb57-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-192"><a href="#cb57-192" aria-hidden="true" tabindex="-1"></a>Welche Spalten haben viele fehlende Werte?</span>
<span id="cb57-193"><a href="#cb57-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-196"><a href="#cb57-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-197"><a href="#cb57-197" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb57-198"><a href="#cb57-198" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_distribution</span>(d_train)</span>
<span id="cb57-199"><a href="#cb57-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-200"><a href="#cb57-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-201"><a href="#cb57-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-202"><a href="#cb57-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-205"><a href="#cb57-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-206"><a href="#cb57-206" aria-hidden="true" tabindex="-1"></a>sum_isna <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">sum</span>(<span class="fu">is.na</span>(x))}</span>
<span id="cb57-207"><a href="#cb57-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-208"><a href="#cb57-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-209"><a href="#cb57-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-212"><a href="#cb57-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-213"><a href="#cb57-213" aria-hidden="true" tabindex="-1"></a>d_train <span class="sc">%&gt;%</span> </span>
<span id="cb57-214"><a href="#cb57-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum_isna))</span>
<span id="cb57-215"><a href="#cb57-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-216"><a href="#cb57-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-217"><a href="#cb57-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-218"><a href="#cb57-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-219"><a href="#cb57-219" aria-hidden="true" tabindex="-1"></a><span class="fu"># Rezept</span></span>
<span id="cb57-220"><a href="#cb57-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-221"><a href="#cb57-221" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rezept definieren</span></span>
<span id="cb57-222"><a href="#cb57-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-223"><a href="#cb57-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-226"><a href="#cb57-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-227"><a href="#cb57-227" aria-hidden="true" tabindex="-1"></a>rec2 <span class="ot">&lt;-</span></span>
<span id="cb57-228"><a href="#cb57-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(revenue <span class="sc">~</span> ., <span class="at">data =</span> d_train) <span class="sc">%&gt;%</span> </span>
<span id="cb57-229"><a href="#cb57-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">budget =</span> <span class="fu">ifelse</span>(budget <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, budget)) <span class="sc">%&gt;%</span>  <span class="co"># log mag keine 0</span></span>
<span id="cb57-230"><a href="#cb57-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_log</span>(budget) <span class="sc">%&gt;%</span> </span>
<span id="cb57-231"><a href="#cb57-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb57-232"><a href="#cb57-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())  <span class="sc">%&gt;%</span> </span>
<span id="cb57-233"><a href="#cb57-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id"</span>)</span>
<span id="cb57-234"><a href="#cb57-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-235"><a href="#cb57-235" aria-hidden="true" tabindex="-1"></a>rec2</span>
<span id="cb57-236"><a href="#cb57-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-237"><a href="#cb57-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-238"><a href="#cb57-238" aria-hidden="true" tabindex="-1"></a>Schauen Sie mal, der Log mag keine Nullen:</span>
<span id="cb57-239"><a href="#cb57-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-242"><a href="#cb57-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-243"><a href="#cb57-243" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">0</span>)</span>
<span id="cb57-244"><a href="#cb57-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-245"><a href="#cb57-245" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(x)</span>
<span id="cb57-246"><a href="#cb57-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-247"><a href="#cb57-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-248"><a href="#cb57-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-249"><a href="#cb57-249" aria-hidden="true" tabindex="-1"></a>Da $log(0) = -\infty$. Aus dem Grund wandeln wir 0 lieber in <span class="in">`NA`</span> um.</span>
<span id="cb57-250"><a href="#cb57-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-253"><a href="#cb57-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-254"><a href="#cb57-254" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(rec2)</span>
<span id="cb57-255"><a href="#cb57-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-256"><a href="#cb57-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-257"><a href="#cb57-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-258"><a href="#cb57-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-259"><a href="#cb57-259" aria-hidden="true" tabindex="-1"></a><span class="fu">## Check das Rezept </span></span>
<span id="cb57-260"><a href="#cb57-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-261"><a href="#cb57-261" aria-hidden="true" tabindex="-1"></a>Wir berechnen das Rezept:</span>
<span id="cb57-262"><a href="#cb57-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-263"><a href="#cb57-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-266"><a href="#cb57-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-267"><a href="#cb57-267" aria-hidden="true" tabindex="-1"></a>rec2_prepped <span class="ot">&lt;-</span></span>
<span id="cb57-268"><a href="#cb57-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(rec2, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-269"><a href="#cb57-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-270"><a href="#cb57-270" aria-hidden="true" tabindex="-1"></a>rec2_prepped</span>
<span id="cb57-271"><a href="#cb57-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-272"><a href="#cb57-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-273"><a href="#cb57-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-274"><a href="#cb57-274" aria-hidden="true" tabindex="-1"></a>Das ist noch *nicht* auf einen Datensatz angewendet! Lediglich die `steps` wurden *vorbereitet*, "präpariert": z.B.</span>
<span id="cb57-275"><a href="#cb57-275" aria-hidden="true" tabindex="-1"></a>"Diese Dummy-Variablen impliziert das Rezept".</span>
<span id="cb57-276"><a href="#cb57-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-277"><a href="#cb57-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-278"><a href="#cb57-278" aria-hidden="true" tabindex="-1"></a>So sieht das dann aus, wenn man das *präparierte* Rezept auf das Train-Sample anwendet:</span>
<span id="cb57-279"><a href="#cb57-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-280"><a href="#cb57-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-281"><a href="#cb57-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-284"><a href="#cb57-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-285"><a href="#cb57-285" aria-hidden="true" tabindex="-1"></a>d_train_baked2 <span class="ot">&lt;-</span></span>
<span id="cb57-286"><a href="#cb57-286" aria-hidden="true" tabindex="-1"></a>  rec2_prepped <span class="sc">%&gt;%</span> </span>
<span id="cb57-287"><a href="#cb57-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>) </span>
<span id="cb57-288"><a href="#cb57-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-289"><a href="#cb57-289" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d_train_baked2)</span>
<span id="cb57-290"><a href="#cb57-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-291"><a href="#cb57-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-292"><a href="#cb57-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-293"><a href="#cb57-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-294"><a href="#cb57-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-297"><a href="#cb57-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-298"><a href="#cb57-298" aria-hidden="true" tabindex="-1"></a>d_train_baked2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-299"><a href="#cb57-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(sum_isna)</span>
<span id="cb57-300"><a href="#cb57-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-301"><a href="#cb57-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-302"><a href="#cb57-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-303"><a href="#cb57-303" aria-hidden="true" tabindex="-1"></a>Keine fehlenden Werte mehr *in den Prädiktoren*.</span>
<span id="cb57-304"><a href="#cb57-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-305"><a href="#cb57-305" aria-hidden="true" tabindex="-1"></a>Nach fehlenden Werten könnte man z.B. auch so suchen:</span>
<span id="cb57-306"><a href="#cb57-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-307"><a href="#cb57-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r describe-distr}</span></span>
<span id="cb57-308"><a href="#cb57-308" aria-hidden="true" tabindex="-1"></a>datawizard<span class="sc">::</span><span class="fu">describe_distribution</span>(d_train_baked2)</span>
<span id="cb57-309"><a href="#cb57-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-310"><a href="#cb57-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-311"><a href="#cb57-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-312"><a href="#cb57-312" aria-hidden="true" tabindex="-1"></a>So bekommt man gleich noch ein paar Infos über die Verteilung der Variablen. Praktische Sache.</span>
<span id="cb57-313"><a href="#cb57-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-314"><a href="#cb57-314" aria-hidden="true" tabindex="-1"></a><span class="fu">## Check Test-Sample</span></span>
<span id="cb57-315"><a href="#cb57-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-316"><a href="#cb57-316" aria-hidden="true" tabindex="-1"></a>Das Test-Sample backen wir auch mal, um zu prüfen, das alles läuft:</span>
<span id="cb57-317"><a href="#cb57-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-320"><a href="#cb57-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-321"><a href="#cb57-321" aria-hidden="true" tabindex="-1"></a>d_test_baked2 <span class="ot">&lt;-</span></span>
<span id="cb57-322"><a href="#cb57-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(rec2_prepped, <span class="at">new_data =</span> d_test)</span>
<span id="cb57-323"><a href="#cb57-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-324"><a href="#cb57-324" aria-hidden="true" tabindex="-1"></a>d_test_baked2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-325"><a href="#cb57-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb57-326"><a href="#cb57-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-327"><a href="#cb57-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-328"><a href="#cb57-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-329"><a href="#cb57-329" aria-hidden="true" tabindex="-1"></a>Sieht soweit gut aus.</span>
<span id="cb57-330"><a href="#cb57-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-331"><a href="#cb57-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-332"><a href="#cb57-332" aria-hidden="true" tabindex="-1"></a><span class="fu"># Kreuzvalidierung / Resampling</span></span>
<span id="cb57-333"><a href="#cb57-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-334"><a href="#cb57-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-335"><a href="#cb57-335" aria-hidden="true" tabindex="-1"></a>Hier ist *nur* aus Gründen der Rechenzeit auf kleine Werte von $v$ und $r$ ausgewichen worden.</span>
<span id="cb57-336"><a href="#cb57-336" aria-hidden="true" tabindex="-1"></a>Besser wäre z.B. $v=10$ und $r=3$.</span>
<span id="cb57-337"><a href="#cb57-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-338"><a href="#cb57-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cv-def}</span></span>
<span id="cb57-339"><a href="#cb57-339" aria-hidden="true" tabindex="-1"></a>cv_scheme <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(d_train,</span>
<span id="cb57-340"><a href="#cb57-340" aria-hidden="true" tabindex="-1"></a>                      <span class="at">v =</span> <span class="dv">3</span>, </span>
<span id="cb57-341"><a href="#cb57-341" aria-hidden="true" tabindex="-1"></a>                      <span class="at">repeats =</span> <span class="dv">1</span>)</span>
<span id="cb57-342"><a href="#cb57-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-343"><a href="#cb57-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-344"><a href="#cb57-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-345"><a href="#cb57-345" aria-hidden="true" tabindex="-1"></a><span class="fu"># Modelle</span></span>
<span id="cb57-346"><a href="#cb57-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-347"><a href="#cb57-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-348"><a href="#cb57-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-349"><a href="#cb57-349" aria-hidden="true" tabindex="-1"></a><span class="fu">## LM</span></span>
<span id="cb57-350"><a href="#cb57-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-351"><a href="#cb57-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-354"><a href="#cb57-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-355"><a href="#cb57-355" aria-hidden="true" tabindex="-1"></a>mod_lm <span class="ot">&lt;-</span></span>
<span id="cb57-356"><a href="#cb57-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>()</span>
<span id="cb57-357"><a href="#cb57-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-358"><a href="#cb57-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-359"><a href="#cb57-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-360"><a href="#cb57-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-361"><a href="#cb57-361" aria-hidden="true" tabindex="-1"></a><span class="fu"># Workflow-Set</span></span>
<span id="cb57-362"><a href="#cb57-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-363"><a href="#cb57-363" aria-hidden="true" tabindex="-1"></a>Hier nur ein sehr kleiner Workflow-Set.</span>
<span id="cb57-364"><a href="#cb57-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-365"><a href="#cb57-365" aria-hidden="true" tabindex="-1"></a>Das ist übrigens eine gute Strategie: Erstmal mit einem kleinen Prozess anfangen,</span>
<span id="cb57-366"><a href="#cb57-366" aria-hidden="true" tabindex="-1"></a>und dann sukzessive erweitern.</span>
<span id="cb57-367"><a href="#cb57-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-368"><a href="#cb57-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-369"><a href="#cb57-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r all-wfs}</span></span>
<span id="cb57-370"><a href="#cb57-370" aria-hidden="true" tabindex="-1"></a>preproc2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">rec1 =</span> rec2)</span>
<span id="cb57-371"><a href="#cb57-371" aria-hidden="true" tabindex="-1"></a>models2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">lm1 =</span> mod_lm)</span>
<span id="cb57-372"><a href="#cb57-372" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb57-373"><a href="#cb57-373" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb57-374"><a href="#cb57-374" aria-hidden="true" tabindex="-1"></a>all_workflows2 <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(preproc2, models2)</span>
<span id="cb57-375"><a href="#cb57-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-376"><a href="#cb57-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-377"><a href="#cb57-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-378"><a href="#cb57-378" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fitten und tunen</span></span>
<span id="cb57-379"><a href="#cb57-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-380"><a href="#cb57-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-381"><a href="#cb57-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tune}</span></span>
<span id="cb57-382"><a href="#cb57-382" aria-hidden="true" tabindex="-1"></a>tmdb_model_set2 <span class="ot">&lt;-</span></span>
<span id="cb57-383"><a href="#cb57-383" aria-hidden="true" tabindex="-1"></a>    all_workflows2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-384"><a href="#cb57-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">workflow_map</span>(<span class="at">resamples =</span> cv_scheme,</span>
<span id="cb57-385"><a href="#cb57-385" aria-hidden="true" tabindex="-1"></a>                 <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-386"><a href="#cb57-386" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fn =</span> <span class="st">"tune_race_anova"</span>)</span>
<span id="cb57-387"><a href="#cb57-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-388"><a href="#cb57-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-389"><a href="#cb57-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-390"><a href="#cb57-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-391"><a href="#cb57-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-392"><a href="#cb57-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-393"><a href="#cb57-393" aria-hidden="true" tabindex="-1"></a><span class="fu"># Finalisieren</span></span>
<span id="cb57-394"><a href="#cb57-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-395"><a href="#cb57-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-398"><a href="#cb57-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-399"><a href="#cb57-399" aria-hidden="true" tabindex="-1"></a>tmdb_model_set2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-400"><a href="#cb57-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb57-401"><a href="#cb57-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>mean) <span class="sc">%&gt;%</span> </span>
<span id="cb57-402"><a href="#cb57-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb57-403"><a href="#cb57-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-404"><a href="#cb57-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-405"><a href="#cb57-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-408"><a href="#cb57-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-409"><a href="#cb57-409" aria-hidden="true" tabindex="-1"></a>best_model_params2 <span class="ot">&lt;-</span></span>
<span id="cb57-410"><a href="#cb57-410" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_workflow_set_result</span>(tmdb_model_set2, <span class="st">"rec1_lm1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-411"><a href="#cb57-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>()</span>
<span id="cb57-412"><a href="#cb57-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-413"><a href="#cb57-413" aria-hidden="true" tabindex="-1"></a>best_model_params2</span>
<span id="cb57-414"><a href="#cb57-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-415"><a href="#cb57-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-416"><a href="#cb57-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-417"><a href="#cb57-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-418"><a href="#cb57-418" aria-hidden="true" tabindex="-1"></a><span class="fu">## Finalisieren</span></span>
<span id="cb57-419"><a href="#cb57-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-420"><a href="#cb57-420" aria-hidden="true" tabindex="-1"></a>Finalisieren bedeutet:</span>
<span id="cb57-421"><a href="#cb57-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-422"><a href="#cb57-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Besten Workflow identifizieren (zur Erinnerung: Workflow = Rezept + Modell)</span>
<span id="cb57-423"><a href="#cb57-423" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Den besten Workflow mit den optimalen Modell-Parametern ausstatten</span>
<span id="cb57-424"><a href="#cb57-424" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Damit dann den ganzen Train-Datensatz fitten</span>
<span id="cb57-425"><a href="#cb57-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Auf dieser Basis das Test-Sample vorhersagen</span>
<span id="cb57-426"><a href="#cb57-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-429"><a href="#cb57-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-430"><a href="#cb57-430" aria-hidden="true" tabindex="-1"></a>best_wf2 <span class="ot">&lt;-</span> </span>
<span id="cb57-431"><a href="#cb57-431" aria-hidden="true" tabindex="-1"></a>all_workflows2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-432"><a href="#cb57-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">"rec1_lm1"</span>)</span>
<span id="cb57-433"><a href="#cb57-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-434"><a href="#cb57-434" aria-hidden="true" tabindex="-1"></a>best_wf2</span>
<span id="cb57-435"><a href="#cb57-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-436"><a href="#cb57-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-437"><a href="#cb57-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-440"><a href="#cb57-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-441"><a href="#cb57-441" aria-hidden="true" tabindex="-1"></a>best_wf_finalized2 <span class="ot">&lt;-</span> </span>
<span id="cb57-442"><a href="#cb57-442" aria-hidden="true" tabindex="-1"></a>  best_wf2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-443"><a href="#cb57-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_model_params2)</span>
<span id="cb57-444"><a href="#cb57-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-445"><a href="#cb57-445" aria-hidden="true" tabindex="-1"></a>best_wf_finalized2</span>
<span id="cb57-446"><a href="#cb57-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-447"><a href="#cb57-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-448"><a href="#cb57-448" aria-hidden="true" tabindex="-1"></a><span class="fu">## Final Fit</span></span>
<span id="cb57-449"><a href="#cb57-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-450"><a href="#cb57-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-453"><a href="#cb57-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-454"><a href="#cb57-454" aria-hidden="true" tabindex="-1"></a>fit_final2 <span class="ot">&lt;-</span></span>
<span id="cb57-455"><a href="#cb57-455" aria-hidden="true" tabindex="-1"></a>  best_wf_finalized2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-456"><a href="#cb57-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(d_train)</span>
<span id="cb57-457"><a href="#cb57-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-458"><a href="#cb57-458" aria-hidden="true" tabindex="-1"></a>fit_final2</span>
<span id="cb57-459"><a href="#cb57-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-460"><a href="#cb57-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-461"><a href="#cb57-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-462"><a href="#cb57-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-463"><a href="#cb57-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r error = TRUE}</span></span>
<span id="cb57-464"><a href="#cb57-464" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> </span>
<span id="cb57-465"><a href="#cb57-465" aria-hidden="true" tabindex="-1"></a>fit_final2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-466"><a href="#cb57-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> d_test)</span>
<span id="cb57-467"><a href="#cb57-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-468"><a href="#cb57-468" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(preds)</span>
<span id="cb57-469"><a href="#cb57-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-470"><a href="#cb57-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-471"><a href="#cb57-471" aria-hidden="true" tabindex="-1"></a>Achtung, wenn die Outcome-Variable im Rezept verändert wurde,</span>
<span id="cb57-472"><a href="#cb57-472" aria-hidden="true" tabindex="-1"></a>dann würde obiger Code *nicht* durchlaufen.</span>
<span id="cb57-473"><a href="#cb57-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-474"><a href="#cb57-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-475"><a href="#cb57-475" aria-hidden="true" tabindex="-1"></a>Grund ist <span class="co">[</span><span class="ot">hier</span><span class="co">](https://github.com/tidymodels/workflows/issues/63)</span> beschrieben:</span>
<span id="cb57-476"><a href="#cb57-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-477"><a href="#cb57-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-478"><a href="#cb57-478" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;    When predict() is used, it only has access to the predictors (mirroring how this would work with new samples). Even if the outcome column is present, it is not exposed to the recipe. This is generally a good idea so that we can avoid information leakage.</span></span>
<span id="cb57-479"><a href="#cb57-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-480"><a href="#cb57-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-481"><a href="#cb57-481" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;    One approach is the use the skip = TRUE option in step_log() so that it will avoid that step during predict() and/or bake(). However, if you are using this recipe with the tune package, there will still be an issue because the metric function(s) would get the predictions in log units and the observed outcome in the original units.</span></span>
<span id="cb57-482"><a href="#cb57-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-483"><a href="#cb57-483" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;   The better approach is, for simple transformations like yours, to log the outcome outside of the recipe (before data analysis and the initial split).</span></span>
<span id="cb57-484"><a href="#cb57-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-485"><a href="#cb57-485" aria-hidden="true" tabindex="-1"></a><span class="fu">## Submission df</span></span>
<span id="cb57-486"><a href="#cb57-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-487"><a href="#cb57-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-490"><a href="#cb57-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-491"><a href="#cb57-491" aria-hidden="true" tabindex="-1"></a>submission_df <span class="ot">&lt;-</span></span>
<span id="cb57-492"><a href="#cb57-492" aria-hidden="true" tabindex="-1"></a>  d_test <span class="sc">%&gt;%</span> </span>
<span id="cb57-493"><a href="#cb57-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb57-494"><a href="#cb57-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(preds) <span class="sc">%&gt;%</span> </span>
<span id="cb57-495"><a href="#cb57-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">revenue =</span> .pred)</span>
<span id="cb57-496"><a href="#cb57-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-497"><a href="#cb57-497" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(submission_df)</span>
<span id="cb57-498"><a href="#cb57-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-499"><a href="#cb57-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-500"><a href="#cb57-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-501"><a href="#cb57-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-502"><a href="#cb57-502" aria-hidden="true" tabindex="-1"></a><span class="fu">## Zurücktransformieren</span></span>
<span id="cb57-503"><a href="#cb57-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-504"><a href="#cb57-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-507"><a href="#cb57-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-508"><a href="#cb57-508" aria-hidden="true" tabindex="-1"></a>submission_df <span class="ot">&lt;-</span></span>
<span id="cb57-509"><a href="#cb57-509" aria-hidden="true" tabindex="-1"></a>  submission_df <span class="sc">%&gt;%</span> </span>
<span id="cb57-510"><a href="#cb57-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue =</span> <span class="fu">exp</span>(revenue)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb57-511"><a href="#cb57-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-512"><a href="#cb57-512" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(submission_df)</span>
<span id="cb57-513"><a href="#cb57-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-514"><a href="#cb57-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-515"><a href="#cb57-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-516"><a href="#cb57-516" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Hier</span><span class="co">](https://numpy.org/doc/stable/reference/generated/numpy.expm1.html)</span> ein Beispiel,</span>
<span id="cb57-517"><a href="#cb57-517" aria-hidden="true" tabindex="-1"></a>warum $e^x-1$ genauer ist für kleine Zahlen als $e^x$.</span>
<span id="cb57-518"><a href="#cb57-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-519"><a href="#cb57-519" aria-hidden="true" tabindex="-1"></a>Abspeichern und einreichen:</span>
<span id="cb57-520"><a href="#cb57-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-521"><a href="#cb57-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb57-522"><a href="#cb57-522" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(submission_df, <span class="at">file =</span> <span class="st">"submission.csv"</span>)</span>
<span id="cb57-523"><a href="#cb57-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-524"><a href="#cb57-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-525"><a href="#cb57-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-526"><a href="#cb57-526" aria-hidden="true" tabindex="-1"></a><span class="fu"># Kaggle Score</span></span>
<span id="cb57-527"><a href="#cb57-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-528"><a href="#cb57-528" aria-hidden="true" tabindex="-1"></a>Diese Submission erzielte einen Score von **Score: 2.46249** (RMSLE).</span>
<span id="cb57-529"><a href="#cb57-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-532"><a href="#cb57-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-533"><a href="#cb57-533" aria-hidden="true" tabindex="-1"></a>sol <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb57-534"><a href="#cb57-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-535"><a href="#cb57-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-536"><a href="#cb57-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-537"><a href="#cb57-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-538"><a href="#cb57-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-539"><a href="#cb57-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-540"><a href="#cb57-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-541"><a href="#cb57-541" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb57-542"><a href="#cb57-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-543"><a href="#cb57-543" aria-hidden="true" tabindex="-1"></a>Categories: </span>
<span id="cb57-544"><a href="#cb57-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-545"><a href="#cb57-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ds1</span>
<span id="cb57-546"><a href="#cb57-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>tidymodels</span>
<span id="cb57-547"><a href="#cb57-547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>statlearning</span>
<span id="cb57-548"><a href="#cb57-548" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>tmdb</span>
<span id="cb57-549"><a href="#cb57-549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>random-forest</span>
<span id="cb57-550"><a href="#cb57-550" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>num</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Powered by <a href="https://quarto.org">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://sebastiansauer.github.io/Datenwerk/impressum.html">Impressum</a></p>
<div class="toc-actions"><ul><li><a href="https://github.com/sebastiansauer/Datenwerk/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p><a href="https://sebastiansauer.github.io/Datenwerk/datenschutz.html">Datenschutzhinweise</a></p>
</div>
  </div>
</footer>




</body></html>