<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-06-29">

<title>flights-delay-simplified – datenwerk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-36228135ecc5ef07794e934de038b4b3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">datenwerk</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Ans Werk, Daten!</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Hinweise.html"> 
<span class="menu-text">Hinweise</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../English.html"> 
<span class="menu-text">English</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sebastiansauer/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#hintergrund-und-forschungsfrage" id="toc-hintergrund-und-forschungsfrage" class="nav-link active" data-scroll-target="#hintergrund-und-forschungsfrage"><span class="header-section-number">1</span> Hintergrund und Forschungsfrage</a></li>
  <li><a href="#ressourcen-und-vertiefung" id="toc-ressourcen-und-vertiefung" class="nav-link" data-scroll-target="#ressourcen-und-vertiefung"><span class="header-section-number">2</span> Ressourcen und Vertiefung</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">3</span> Setup</a>
  <ul class="collapse">
  <li><a href="#pakete-laden" id="toc-pakete-laden" class="nav-link" data-scroll-target="#pakete-laden"><span class="header-section-number">3.1</span> Pakete laden</a></li>
  <li><a href="#daten-laden-flights-2023" id="toc-daten-laden-flights-2023" class="nav-link" data-scroll-target="#daten-laden-flights-2023"><span class="header-section-number">3.2</span> Daten laden: Flights 2023</a></li>
  </ul></li>
  <li><a href="#flights2-nicht-benötigte-variablen-entfernen-und-id-hinzufügen" id="toc-flights2-nicht-benötigte-variablen-entfernen-und-id-hinzufügen" class="nav-link" data-scroll-target="#flights2-nicht-benötigte-variablen-entfernen-und-id-hinzufügen"><span class="header-section-number">4</span> flights2: Nicht benötigte Variablen entfernen und ID hinzufügen</a></li>
  <li><a href="#heimliche-avs-entfernen" id="toc-heimliche-avs-entfernen" class="nav-link" data-scroll-target="#heimliche-avs-entfernen"><span class="header-section-number">5</span> Heimliche AVs entfernen</a></li>
  <li><a href="#aufteilung-in-train--und-testsample" id="toc-aufteilung-in-train--und-testsample" class="nav-link" data-scroll-target="#aufteilung-in-train--und-testsample"><span class="header-section-number">6</span> Aufteilung in Train- und Testsample</a></li>
  <li><a href="#flights_train2-flights_test2" id="toc-flights_train2-flights_test2" class="nav-link" data-scroll-target="#flights_train2-flights_test2"><span class="header-section-number">7</span> flights_train2, flights_test2</a></li>
  <li><a href="#lm0-nullmodell" id="toc-lm0-nullmodell" class="nav-link" data-scroll-target="#lm0-nullmodell"><span class="header-section-number">8</span> lm0: Nullmodell</a></li>
  <li><a href="#lm1-origin" id="toc-lm1-origin" class="nav-link" data-scroll-target="#lm1-origin"><span class="header-section-number">9</span> lm1: origin</a></li>
  <li><a href="#lm2-all-in" id="toc-lm2-all-in" class="nav-link" data-scroll-target="#lm2-all-in"><span class="header-section-number">10</span> lm2: All in</a></li>
  <li><a href="#lm3-verlorenes-modell" id="toc-lm3-verlorenes-modell" class="nav-link" data-scroll-target="#lm3-verlorenes-modell"><span class="header-section-number">11</span> lm3: Verlorenes Modell</a></li>
  <li><a href="#lm4-alle-metrischen-variablen" id="toc-lm4-alle-metrischen-variablen" class="nav-link" data-scroll-target="#lm4-alle-metrischen-variablen"><span class="header-section-number">12</span> lm4: Alle metrischen Variablen</a></li>
  <li><a href="#flights_train5-fehlenden-werte-ersetzen" id="toc-flights_train5-fehlenden-werte-ersetzen" class="nav-link" data-scroll-target="#flights_train5-fehlenden-werte-ersetzen"><span class="header-section-number">13</span> flights_train5: Fehlenden Werte ersetzen</a></li>
  <li><a href="#lm6-wie-lm5-aber-ohne-fehlende-werte" id="toc-lm6-wie-lm5-aber-ohne-fehlende-werte" class="nav-link" data-scroll-target="#lm6-wie-lm5-aber-ohne-fehlende-werte"><span class="header-section-number">14</span> lm6: Wie lm5, aber ohne fehlende Werte</a></li>
  <li><a href="#flights_train6-extremwerte-entfernen" id="toc-flights_train6-extremwerte-entfernen" class="nav-link" data-scroll-target="#flights_train6-extremwerte-entfernen"><span class="header-section-number">15</span> flights_train6: Extremwerte entfernen</a></li>
  <li><a href="#lm7-wie-lm5-aber-ohne-extremwerte-für-distance" id="toc-lm7-wie-lm5-aber-ohne-extremwerte-für-distance" class="nav-link" data-scroll-target="#lm7-wie-lm5-aber-ohne-extremwerte-für-distance"><span class="header-section-number">16</span> lm7: Wie lm5, aber ohne Extremwerte für <code>distance</code></a></li>
  <li><a href="#r2-im-testsample" id="toc-r2-im-testsample" class="nav-link" data-scroll-target="#r2-im-testsample"><span class="header-section-number">17</span> R2 im Testsample</a></li>
  <li><a href="#einreichen" id="toc-einreichen" class="nav-link" data-scroll-target="#einreichen"><span class="header-section-number">18</span> Einreichen</a></li>
  <li><a href="#was-noch" id="toc-was-noch" class="nav-link" data-scroll-target="#was-noch"><span class="header-section-number">19</span> Was noch?</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/sebastiansauer/Datenwerk/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">flights-delay-simplified</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">lm</div>
    <div class="quarto-category">regression</div>
    <div class="quarto-category">interaction</div>
    <div class="quarto-category">yacsda</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 29, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="hintergrund-und-forschungsfrage" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Hintergrund und Forschungsfrage</h1>
<p>Wir untersuchen die Forschungsfrage <em>Was sind Prädiktoren von Flugverspätungen</em>. Wir nutzen <code>dep_delay</code> als AV (Zielvariable), also als die Variable, die wir vorhersagen wollen.</p>
<p>Dazu verwenden wir lineare Modelle als Modellierungsmethoden.</p>
</section>
<section id="ressourcen-und-vertiefung" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Ressourcen und Vertiefung</h1>
<p>Dieser Post knüpft an <a href="https://data-se.netlify.app/2021/03/08/eda-zu-flugversp%C3%A4tungen/">den Post zur explorativen Datenanalyse der Flugverspätungen</a> an (es gibt auch <a href="https://www.youtube.com/watch?v=t8i_qTonuLM">hier, Teil 1</a> und <a href="https://youtu.be/AeBqwr2U7MA">hier, Teil 2</a> ein Video zu diesem EDA-Post). <a href="https://datenwerk.netlify.app/posts/flights-delay/">Dieser Post</a> ist eine längere (nicht-verkürzte) Version der vorliegenden Fallstudie.</p>
</section>
<section id="setup" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Setup</h1>
<section id="pakete-laden" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="pakete-laden"><span class="header-section-number">3.1</span> Pakete laden</h2>
<p>Wirklich wichtig sind nur <code>tidymodels</code> und <code>tidyverse</code>. Die restlichen Pakete werden nur am Rande benötigt. Man sollte auch nur die Pakete laden, die man für die Analyse benötigt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidymodels"</span>)  <span class="co"># Train- und Test-Sample aufteilen</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)  <span class="co"># data wrangling</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"conflicted"</span>)  <span class="co"># Name clashes finden</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"easystats"</span>)  <span class="co"># stats made easy</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"DataExplorer"</span>)  <span class="co"># Data Vis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="daten-laden-flights-2023" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="daten-laden-flights-2023"><span class="header-section-number">3.2</span> Daten laden: Flights 2023</h2>
<p>Aus Gründen der Datenökonomie nutzen wir eine kleinere Version des Datensatz <code>flights</code>. Wir nutzen nicht mehr die Daten aus dem 2013, sondern die neueren Daten aus dem Jahr 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights23)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(flights)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># Reproduzierbarkeit</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  flights <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fl">3e4</span>)  <span class="co"># "3e4" heißt "3 Mal 10 hoch 4"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Achtung: <code>flights</code> ist recht groß; die Regressionsmodelle können leicht ein paar Hundert Megabyte groß werden. Das bringt u.U. auch einen modernen Computer irgendwann ins Straucheln. Daher verringern wir aus Gründen der Einfachheit den Datensatz mit einem Zufallssample. Man beachte, dass die Präzision der Ergebnisse höher ist, wenn man nicht mit einem Zufallssample, sondern dem gesamten Datensatz arbeitet.</p>
</section>
</section>
<section id="flights2-nicht-benötigte-variablen-entfernen-und-id-hinzufügen" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> flights2: Nicht benötigte Variablen entfernen und ID hinzufügen</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  flights <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(year)) <span class="sc">%&gt;%</span>   <span class="co"># "year" ist konstant und daher nutzlos</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(dep_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span>  <span class="co"># ID als fortlaufende Nummer</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="fu">everything</span>())  <span class="co"># id nach vorne ziehen</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die ID hilft uns, einzelne Flüge (Beobachtungen) zu identifizieren, z.B. wenn wir einen bestimmten Flug näher analysieren oder entfernen wolllen.</p>
<p>Achtung: Die ID-Variable sollte man nicht als Prädiktor verwenden, da sie keine Information birgt.</p>
</section>
<section id="heimliche-avs-entfernen" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Heimliche AVs entfernen</h1>
<p><code>dep_delay</code> ist unsere AV (Zielvariable), die Variable also, die wir vorhersagen.</p>
<p><code>arr_delay</code> ist eine Variable, die uns <em>nicht</em> zur Verfügung steht, wenn es um die Vorhersage neuer, noch nicht gestarteter Flüge geht. Es wäre daher falsch, unser Modell auf einer Variable zu gründen, auf die wir später (beim Vorhersagen) nicht zurückgreifen können. Also raus damit.</p>
<p>Ähnliches gilt für ein paar andere Variablen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>heimliche_avs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dep_time"</span>, <span class="st">"arr_time"</span>, <span class="st">"arr_delay"</span>, <span class="st">"air_time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>flights2_ohne_heimliche_avs <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  flights2 <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">any_of</span>(heimliche_avs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>any_of</code> ist nur eine Tipphilfe. Man hätte auch direkt die Namen der zu entfernenden Spalten eingeben können, etwa <code>select(-dep_time, ...)</code>.</p>
<p>Check:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(flights2_ohne_heimliche_avs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "id"             "month"          "day"            "sched_dep_time"
 [5] "dep_delay"      "sched_arr_time" "carrier"        "flight"        
 [9] "tailnum"        "origin"         "dest"           "distance"      
[13] "hour"           "minute"         "time_hour"     </code></pre>
</div>
</div>
<p>Eine vielleicht gute Nachricht ist, dass Sie sich in der Prüfung nicht um diese Frage kümmern müssen.</p>
</section>
<section id="aufteilung-in-train--und-testsample" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Aufteilung in Train- und Testsample</h1>
<p>Der Hintergrund zur Idee der Aufteilung in Train- und Test-Stichprobe kann z.b. <a href="https://www.tmwr.org/splitting.html">hier</a> oder <a href="https://www.springer.com/de/book/9783658215866">hier</a>, Kapitel 15, nachgelesen werden.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># Reproduzierbarkeit</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>flights_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(flights2_ohne_heimliche_avs, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">strata =</span> dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="flights_train2-flights_test2" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> flights_train2, flights_test2</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># Reproduzierbarkeit</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>flights_train2 <span class="ot">&lt;-</span> <span class="fu">training</span>(flights_split)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>flights_test2 <span class="ot">&lt;-</span> <span class="fu">testing</span>(flights_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die “wirkliche Welt” (was immer das ist) besorgt die Aufteilung von Train- und Test-Sample für Sie automatisch. Sagen wir, Sie arbeiten für die Flughafen-Aufsicht von New York. Dann haben Sie einen Erfahrungsschatz an Flügen aus der Vergangenheit in Ihrer Datenbank (Train-Sample). Einige Tages kommt Ihr Chef zu Ihnen und sagt: “Rechnen Sie mir mal die zu erwartende Verspätung der Flüge <em>im nächsten Monat</em> aus!”. Da <em>heute</em> nicht klar ist, wie die Verspätung der Flüge <em>in der Zukunft</em> (nächsten Monat) sein wird, stellen die Flüge des nächsten Monats das Test-Sample dar.</p>
<p>Übrigens: In der Prüfung besorgt das Aufteilen von Train- und Test-Sample netterweise Ihr Dozent…</p>
<p>Check:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(flights_train2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "id"             "month"          "day"            "sched_dep_time"
 [5] "dep_delay"      "sched_arr_time" "carrier"        "flight"        
 [9] "tailnum"        "origin"         "dest"           "distance"      
[13] "hour"           "minute"         "time_hour"     </code></pre>
</div>
</div>
</section>
<section id="lm0-nullmodell" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> lm0: Nullmodell</h1>
<p>Eigentlich nicht nötig, das Nullmodell, primär aus didaktischen Gründen berechnet, um zu zeigen, dass in diesem Fall <span class="math inline">\(R^2\)</span> wirklich gleich Null ist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lm0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(dep_delay <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> flights_train2)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm0)  <span class="co"># model_parameters zeit die (geschätzten) Regressionsgewichte (Betas)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(21918) |      p
---------------------------------------------------------------------
(Intercept) |       13.95 | 0.38 | [13.21, 14.69] |    36.91 | &lt; .001</code></pre>
</div>
</div>
<p>Wir könnten anstatt <code>model_parameters</code> auch <code>parameters</code> nutzen; das ist der gleiche Befehl.</p>
<p>Allerdings gibt es den Befehl <code>parameters</code> in <em>zwei</em> Paketen, es käme also zu einem “Name Clash”. Das umgehen wir, indem wir <code>model_parameter</code> nutzen, und nicht <code>parameters</code>.</p>
</section>
<section id="lm1-origin" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> lm1: origin</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(dep_delay <span class="sc">~</span> origin, <span class="at">data =</span> flights_train2)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm1)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter    | Coefficient |   SE |         95% CI | t(21916) |      p
----------------------------------------------------------------------
(Intercept)  |       15.61 | 0.67 | [14.30, 16.92] |    23.40 | &lt; .001
origin [JFK] |        0.19 | 0.95 | [-1.68,  2.05] |     0.20 | 0.845 
origin [LGA] |       -4.64 | 0.91 | [-6.42, -2.85] |    -5.09 | &lt; .001</code></pre>
</div>
</div>
<p>Man vergleiche:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>flights_train2 <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(dep_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">delay_avg =</span> <span class="fu">mean</span>(dep_delay)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_delta =</span> delay_avg <span class="sc">-</span> delay_avg[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  origin delay_avg delay_delta
  &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;
1 EWR         15.6       0    
2 JFK         15.8       0.186
3 LGA         11.0      -4.64 </code></pre>
</div>
</div>
<p>Der Mittelwertsvergleich und das Modell <code>lm1</code> sind faktisch informationsgleich.</p>
<p>Aber leider ist es um die Modellgüte nicht so gut bestellt (eigentlich eher “grottenschlecht”):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># R2 for Linear Regression
       R2: 0.002
  adj. R2: 0.002</code></pre>
</div>
</div>
<p><code>lm1</code> ist so schlecht, wir löschen es gleich wieder… ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
</section>
<section id="lm2-all-in" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> lm2: All in</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NICHT AUSFÜHREN</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#lm2_all_in &lt;- lm(dep_delay ~ ., data = flights_train2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modell <code>lm2_all_in</code> ist hier <em>keine</em> gute Idee, da nominale Prädiktoren in Indikatorvariablen umgewandelt werden. Hat ein nominaler Prädiktor sehr viele Stufen (wie hier), so resultieren sehr viele Indikatorvariablen, was dem Regressionsmodell Probleme bereiten kann (bei mir hängt sich R auf). Besser ist es in dem Fall, die Anzahl der Stufen von nominalskalierten Variablen vorab zu begrenzen.</p>
<p>Bei kleineren Datensätzen (weniger Variablen, weniger Fälle) lohnt es sich aber oft, das “All-in-Modell” auszuprobieren, als Referenzmaßstab für andere Modelle.</p>
</section>
<section id="lm3-verlorenes-modell" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> lm3: Verlorenes Modell</h1>
<p>Dieses Modell ging verloren. Wo ist es hin? Wie geht es ihm? Leider gibt es keine Antwort in dieser Fallstudie; aber vielleicht in einer anderen…</p>
<p>Einigen Datensätzen ging es leider ebenso.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</section>
<section id="lm4-alle-metrischen-variablen" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> lm4: Alle metrischen Variablen</h1>
<p>Was sind noch mal unsere metrischen Variablen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>flights_train4 <span class="ot">&lt;-</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>flights_train2 <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>month, <span class="sc">-</span>day, <span class="sc">-</span>flight)   <span class="co"># diese Variablen sind nicht wirklich metrisch</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>flights_train4 <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "id"             "sched_dep_time" "dep_delay"      "sched_arr_time"
[5] "distance"       "hour"           "minute"        </code></pre>
</div>
</div>
<p>Ok, jetzt eine Regression mit diesen Variablen (ober ohne die ID-Variable):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lm4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(dep_delay <span class="sc">~</span> ., </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> (flights_train4 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>id)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># R2 for Linear Regression
       R2: 0.016
  adj. R2: 0.016</code></pre>
</div>
</div>
<p>Tja, das <span class="math inline">\(R^2\)</span> hat einen nicht gerade um …</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter      | Coefficient |       SE |          95% CI | t(21914) |      p
-----------------------------------------------------------------------------
(Intercept)    |       -7.41 |     1.42 | [-10.19, -4.63] |    -5.22 | &lt; .001
sched dep time |        0.02 |     0.02 | [ -0.01,  0.06] |     1.26 | 0.208 
sched arr time |   -3.32e-03 | 1.10e-03 | [ -0.01,  0.00] |    -3.01 | 0.003 
distance       |    4.03e-03 | 5.36e-04 | [  0.00,  0.01] |     7.53 | &lt; .001
hour           |       -0.79 |     1.94 | [ -4.59,  3.01] |    -0.41 | 0.683 </code></pre>
</div>
</div>
<p>Die Distanz zum Ziel ist offenbar der interessanteste Prädiktor.</p>
</section>
<section id="flights_train5-fehlenden-werte-ersetzen" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> flights_train5: Fehlenden Werte ersetzen</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>flights_train4 <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">describe_distribution</span>() <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Variable, n_Missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variable       | n_Missing
--------------------------
id             |         0
sched_dep_time |         0
dep_delay      |         0
sched_arr_time |         0
distance       |         0
hour           |         0
minute         |         0</code></pre>
</div>
</div>
<p>Glücklicherweise haben wir keine fehlende Werte.</p>
<p>Nur rein zu Übungszwecken: Falls es fehlende Werte gibt, man könnte sie z.B. so mit dem Median ersetzen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  flights_train4 <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance =</span> <span class="fu">replace_na</span>(distance, <span class="fu">median</span>(distance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lm6-wie-lm5-aber-ohne-fehlende-werte" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> lm6: Wie lm5, aber ohne fehlende Werte</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>lm6 <span class="ot">&lt;-</span><span class="fu">lm</span>(dep_delay <span class="sc">~</span> ., <span class="at">data =</span> flights_train5 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>id) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># R2 for Linear Regression
       R2: 0.016
  adj. R2: 0.016</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter      | Coefficient |       SE |          95% CI | t(21914) |      p
-----------------------------------------------------------------------------
(Intercept)    |       -7.41 |     1.42 | [-10.19, -4.63] |    -5.22 | &lt; .001
sched dep time |        0.02 |     0.02 | [ -0.01,  0.06] |     1.26 | 0.208 
sched arr time |   -3.32e-03 | 1.10e-03 | [ -0.01,  0.00] |    -3.01 | 0.003 
distance       |    4.03e-03 | 5.36e-04 | [  0.00,  0.01] |     7.53 | &lt; .001
hour           |       -0.79 |     1.94 | [ -4.59,  3.01] |    -0.41 | 0.683 </code></pre>
</div>
</div>
</section>
<section id="flights_train6-extremwerte-entfernen" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> flights_train6: Extremwerte entfernen</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric), <span class="sc">-</span>id) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-densities-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Es sieht so aus, als wäre <code>distance</code> deutlich rechtsschief mit einigen Ausreißern.</p>
<p>Man könnte auch Boxplots betrachten, die auch gut Extremwerte visualisieren.</p>
<p>Eine gängige Methode, mit Extremwerten umzugehen, ist, alle Datenpunkte, die im Boxplot als alleinstehende Punkte gezeigt werden, durch den Median zu ersetzen. Achtung: Diese Methode ist nicht perfekt! Es gibt viel sophistiziertere Methoden.</p>
<p>Wir ersetzen dabei alle Werte von <code>distance</code>, für die gilt, dass sie größer sind als Q3 + 1.5*IQR.</p>
<p>Q3:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_q3 =</span> <span class="fu">quantile</span>(distance, <span class="at">prob =</span> .<span class="dv">75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  distance_q3
        &lt;dbl&gt;
1        1183</code></pre>
</div>
</div>
<p>IQR:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_iqr =</span> <span class="fu">IQR</span>(distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  distance_iqr
         &lt;dbl&gt;
1          704</code></pre>
</div>
</div>
<p>Der Grenzwert ist also:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(<span class="co"># Q3</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_iqr =</span> <span class="fu">quantile</span>(distance, <span class="at">prob =</span> .<span class="dv">75</span>)) </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.5</span> <span class="sc">*</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a> (<span class="co"># IQR</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_iqr =</span> <span class="fu">IQR</span>(distance)) </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  distance_iqr
1         2239</code></pre>
</div>
</div>
<p>Der Median von <code>distance</code> beträgt übrigens:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a> flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_md =</span> <span class="fu">median</span>(distance)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  distance_md
        &lt;dbl&gt;
1         762</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>flights_train6 <span class="ot">&lt;-</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance =</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(distance <span class="sc">&gt;</span> <span class="dv">2239</span> <span class="sc">~</span> <span class="dv">762</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                     <span class="cn">TRUE</span> <span class="sc">~</span> distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Grob auf Deutsch übersetzt:</p>
<blockquote class="blockquote">
<p>Wenn ein Flug eine <code>distance</code> von mehr als 326 Minuten hat, dann sei die airtime gleich 122, ansonsten immer (“TRUE”) ist airtime gleich <code>distance</code>, bleibt also, wie sie war.</p>
</blockquote>
</section>
<section id="lm7-wie-lm5-aber-ohne-extremwerte-für-distance" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> lm7: Wie lm5, aber ohne Extremwerte für <code>distance</code></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>lm7 <span class="ot">&lt;-</span><span class="fu">lm</span>(dep_delay <span class="sc">~</span> ., <span class="at">data =</span> flights_train6)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># R2 for Linear Regression
       R2: 0.018
  adj. R2: 0.017</code></pre>
</div>
</div>
<p>Tja….</p>
</section>
<section id="r2-im-testsample" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> R2 im Testsample</h1>
<p><span class="math inline">\(R^2\)</span> kann man übrigens auch so berechnen:</p>
<p>Zuerst fügen wir die Vorhersagen zum Datensatz hinzu:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>flights_train7_pred <span class="ot">&lt;-</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  flights_train6 <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lm7_pred =</span> <span class="fu">predict</span>(lm7, <span class="at">newdata =</span> flights_train6))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dann berechnen wir das R-Quadrat mit der Funktion <code>rsq</code> (wie “r squared”, R-Quadrat) anhand der beiden relevanten Spalten:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>flights_train7_pred <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(<span class="at">truth =</span> dep_delay,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> lm7_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rsq     standard      0.0176</code></pre>
</div>
</div>
<p>Das ist nützlich, wenn man R-Quadrat auf Basis eigener Vorhersagen, im Test-Sample also, berechnen will.</p>
<p>Berechnen wir jetzt die Modellgüte im Testsample.</p>
<p>Fügen wir die Vorhersagewerte dem Testsample dazu:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="ot">&lt;-</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  flights_test2 <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_lm7 =</span> <span class="fu">predict</span>(lm7, <span class="at">newdata =</span> flights_test2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, dep_delay, pred_lm7) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
     id dep_delay pred_lm7
  &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1    13         3     4.46
2    15        19    11.6 
3    28        -8    33.0 
4    30        -4    16.2 
5    31       160    20.8 
6    37        -8     2.79</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(<span class="at">truth =</span> dep_delay,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> pred_lm7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rsq     standard      0.0184</code></pre>
</div>
</div>
<p>Am schwierigsten ist es, bei den ganzen Nummerierungen nicht durcheinander zu kommen. Hier könnte es sich lohnen, ein übersichtlicheres Verfahren einzuführen (mit den Kosten höherer Komplexität).</p>
</section>
<section id="einreichen" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Einreichen</h1>
<p>Das beste Modell im <em>Train-Sample</em> reichen wir ein; in diesem Fall <code>lm7</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>submission_df <span class="ot">&lt;-</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="at">pred =</span> pred_lm7)  <span class="co"># gleich umbenennen in "pred"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(submission_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
     id  pred
  &lt;int&gt; &lt;dbl&gt;
1    13  4.46
2    15 11.6 
3    28 33.0 
4    30 16.2 
5    31 20.8 
6    37  2.79</code></pre>
</div>
</div>
<p>Das sieht erstmal gut aus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(submission_df, <span class="at">file =</span> <span class="st">"Sauer_Sebastian_0123456_Prognose.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="was-noch" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Was noch?</h1>
<p>Ein nächster Schritt könnte sein, sich folgende Punkte anzuschauen:</p>
<ul>
<li>Nominale Variablen berücksichtigen</li>
<li>Variablen mit der höchsten Korrelation berücksichtigen</li>
<li>Interaktionseffekte berücksichtigen</li>
</ul>
<p>Eine Faustregel zu Interaktionen lautet: Wenn zwei Variablen jeweils einen starken Haupteffekt haben, lohnt es sich u.U., den Interaktionseffekt anzuschauen (vgl. Gelman &amp; Hill, 2007, S. 69).</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Hintergrund ist, dass diese Fallstudie eine vereinfachte und verkürzte Version einer ähnlichen Fallstudie ist.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb61" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2024-06-29</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> FALSE   # ACHTUNG DRAFT STEHT AUF TRUE!</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> flights-delay-simplified</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: true </span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: true</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: true</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="an">highlight-style:</span><span class="co"> arrow </span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="an">cache:</span><span class="co"> true</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="an">extype:</span><span class="co"> string</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="an">exsolution:</span><span class="co"> ""</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="an">exshuffle:</span><span class="co"> no</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="co">- lm  # ENTER CATEGORIES HERE</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="co">- regression</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co">- interaction</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co">- yacsda</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Hintergrund und Forschungsfrage</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>Wir untersuchen die Forschungsfrage *Was sind Prädiktoren von Flugverspätungen*. </span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>Wir nutzen <span class="in">`dep_delay`</span> als AV (Zielvariable), also als die Variable, die wir vorhersagen wollen.</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>Dazu verwenden wir lineare Modelle als Modellierungsmethoden.</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="fu"># Ressourcen und Vertiefung</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>Dieser Post knüpft an <span class="co">[</span><span class="ot">den Post zur explorativen Datenanalyse der Flugverspätungen</span><span class="co">](https://data-se.netlify.app/2021/03/08/eda-zu-flugversp%C3%A4tungen/)</span> an (es gibt auch <span class="co">[</span><span class="ot">hier, Teil 1</span><span class="co">](https://www.youtube.com/watch?v=t8i_qTonuLM)</span> und <span class="co">[</span><span class="ot">hier, Teil 2</span><span class="co">](https://youtu.be/AeBqwr2U7MA)</span> ein Video zu diesem EDA-Post).</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Dieser Post</span><span class="co">](https://datenwerk.netlify.app/posts/flights-delay/)</span> ist eine längere (nicht-verkürzte) Version der vorliegenden Fallstudie.</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pakete laden</span></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>Wirklich wichtig sind nur <span class="in">`tidymodels`</span> und <span class="in">`tidyverse`</span>. Die restlichen Pakete werden nur am Rande benötigt. </span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>Man sollte auch nur die Pakete laden,</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>die man für die Analyse benötigt.</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-libs, message = FALSE, warning = FALSE}</span></span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidymodels"</span>)  <span class="co"># Train- und Test-Sample aufteilen</span></span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)  <span class="co"># data wrangling</span></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"conflicted"</span>)  <span class="co"># Name clashes finden</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"easystats"</span>)  <span class="co"># stats made easy</span></span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"DataExplorer"</span>)  <span class="co"># Data Vis</span></span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## Daten laden: Flights 2023</span></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a>Aus Gründen der Datenökonomie nutzen wir eine kleinere Version des Datensatz <span class="in">`flights`</span>. </span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a>Wir nutzen nicht mehr die Daten aus dem 2013, sondern die neueren Daten aus dem Jahr 2023.</span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sample-prop-flights}</span></span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights23)</span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(flights)</span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># Reproduzierbarkeit</span></span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> </span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a>  flights <span class="sc">|&gt;</span> </span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fl">3e4</span>)  <span class="co"># "3e4" heißt "3 Mal 10 hoch 4"</span></span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a>Achtung: <span class="in">`flights`</span> ist recht groß; die Regressionsmodelle können leicht ein paar Hundert Megabyte groß werden. Das bringt u.U. auch einen modernen Computer irgendwann ins Straucheln.</span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a>Daher verringern wir aus Gründen der Einfachheit den Datensatz mit einem Zufallssample.</span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a>Man beachte, dass die Präzision der Ergebnisse höher ist, wenn man nicht mit einem Zufallssample, sondern dem gesamten Datensatz arbeitet.</span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-84"><a href="#cb61-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-85"><a href="#cb61-85" aria-hidden="true" tabindex="-1"></a><span class="fu"># flights2: Nicht benötigte Variablen entfernen und ID hinzufügen</span></span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flights2}</span></span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span></span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a>  flights <span class="sc">%&gt;%</span> </span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(year)) <span class="sc">%&gt;%</span>   <span class="co"># "year" ist konstant und daher nutzlos</span></span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(dep_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span>  <span class="co"># ID als fortlaufende Nummer</span></span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="fu">everything</span>())  <span class="co"># id nach vorne ziehen</span></span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-97"><a href="#cb61-97" aria-hidden="true" tabindex="-1"></a>Die ID hilft uns, einzelne Flüge (Beobachtungen) zu identifizieren, z.B. wenn wir einen bestimmten Flug näher analysieren oder entfernen wolllen.</span>
<span id="cb61-98"><a href="#cb61-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-99"><a href="#cb61-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a>Achtung: Die ID-Variable sollte man nicht als Prädiktor verwenden, da sie keine Information birgt.</span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a><span class="fu"># Heimliche AVs entfernen</span></span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a><span class="in">`dep_delay`</span> ist unsere AV (Zielvariable), die Variable also, die wir vorhersagen.</span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a><span class="in">`arr_delay`</span> ist eine Variable, die uns *nicht* zur Verfügung steht, wenn es um die Vorhersage neuer, noch nicht gestarteter Flüge geht.</span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a>Es wäre daher falsch, unser Modell auf einer Variable zu gründen, auf die wir später (beim Vorhersagen) nicht zurückgreifen können.</span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a>Also raus damit.</span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a>Ähnliches gilt für ein paar andere Variablen:</span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-114"><a href="#cb61-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-115"><a href="#cb61-115" aria-hidden="true" tabindex="-1"></a>heimliche_avs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dep_time"</span>, <span class="st">"arr_time"</span>, <span class="st">"arr_delay"</span>, <span class="st">"air_time"</span>)</span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a>flights2_ohne_heimliche_avs <span class="ot">&lt;-</span></span>
<span id="cb61-122"><a href="#cb61-122" aria-hidden="true" tabindex="-1"></a>  flights2 <span class="sc">|&gt;</span> </span>
<span id="cb61-123"><a href="#cb61-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">any_of</span>(heimliche_avs))</span>
<span id="cb61-124"><a href="#cb61-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-125"><a href="#cb61-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a><span class="in">`any_of`</span> ist nur eine Tipphilfe. Man hätte auch direkt die Namen der zu entfernenden Spalten eingeben können, etwa <span class="in">`select(-dep_time, ...)`</span>.</span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a>Check:</span>
<span id="cb61-130"><a href="#cb61-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(flights2_ohne_heimliche_avs)</span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a>Eine vielleicht gute Nachricht ist, dass Sie sich in der Prüfung nicht um diese Frage kümmern müssen.</span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-139"><a href="#cb61-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-140"><a href="#cb61-140" aria-hidden="true" tabindex="-1"></a><span class="fu"># Aufteilung in Train- und Testsample</span></span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a>Der Hintergrund zur Idee der Aufteilung in Train- und Test-Stichprobe kann z.b. <span class="co">[</span><span class="ot">hier</span><span class="co">](https://www.tmwr.org/splitting.html)</span> oder <span class="co">[</span><span class="ot">hier</span><span class="co">](https://www.springer.com/de/book/9783658215866)</span>, Kapitel 15, nachgelesen werden.</span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-split}</span></span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># Reproduzierbarkeit</span></span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a>flights_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(flights2_ohne_heimliche_avs, </span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a>                               <span class="at">strata =</span> dep_delay)</span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-152"><a href="#cb61-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-153"><a href="#cb61-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a><span class="fu"># flights_train2, flights_test2</span></span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r train-test}</span></span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># Reproduzierbarkeit</span></span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a>flights_train2 <span class="ot">&lt;-</span> <span class="fu">training</span>(flights_split)</span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a>flights_test2 <span class="ot">&lt;-</span> <span class="fu">testing</span>(flights_split)</span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a>Die "wirkliche Welt" (was immer das ist) besorgt die Aufteilung von Train- und Test-Sample für Sie automatisch. </span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a>Sagen wir, Sie arbeiten für die Flughafen-Aufsicht von New York. </span>
<span id="cb61-165"><a href="#cb61-165" aria-hidden="true" tabindex="-1"></a>Dann haben Sie einen Erfahrungsschatz an Flügen aus der Vergangenheit in Ihrer Datenbank (Train-Sample). Einige Tages kommt Ihr Chef zu Ihnen und sagt: "Rechnen Sie mir mal die zu erwartende Verspätung der Flüge *im nächsten Monat* aus!". </span>
<span id="cb61-166"><a href="#cb61-166" aria-hidden="true" tabindex="-1"></a>Da *heute* nicht klar ist, wie die Verspätung der Flüge *in der Zukunft* (nächsten Monat) sein wird, stellen die Flüge des nächsten Monats das Test-Sample dar.</span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a>Übrigens: In der Prüfung besorgt das Aufteilen von Train- und Test-Sample netterweise Ihr Dozent...</span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a>Check:</span>
<span id="cb61-173"><a href="#cb61-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-176"><a href="#cb61-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-177"><a href="#cb61-177" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(flights_train2)</span>
<span id="cb61-178"><a href="#cb61-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-179"><a href="#cb61-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-180"><a href="#cb61-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-181"><a href="#cb61-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-182"><a href="#cb61-182" aria-hidden="true" tabindex="-1"></a><span class="fu"># lm0: Nullmodell</span></span>
<span id="cb61-183"><a href="#cb61-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-184"><a href="#cb61-184" aria-hidden="true" tabindex="-1"></a>Eigentlich nicht nötig, das Nullmodell, primär aus didaktischen Gründen berechnet, um zu zeigen, dass in diesem Fall $R^2$ wirklich gleich Null ist.</span>
<span id="cb61-185"><a href="#cb61-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-186"><a href="#cb61-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-187"><a href="#cb61-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm0}</span></span>
<span id="cb61-188"><a href="#cb61-188" aria-hidden="true" tabindex="-1"></a>lm0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(dep_delay <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> flights_train2)</span>
<span id="cb61-189"><a href="#cb61-189" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm0)  <span class="co"># model_parameters zeit die (geschätzten) Regressionsgewichte (Betas)</span></span>
<span id="cb61-190"><a href="#cb61-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-191"><a href="#cb61-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-192"><a href="#cb61-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-193"><a href="#cb61-193" aria-hidden="true" tabindex="-1"></a>Wir könnten anstatt <span class="in">`model_parameters`</span> auch <span class="in">`parameters`</span> nutzen; das ist der gleiche Befehl.</span>
<span id="cb61-194"><a href="#cb61-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-195"><a href="#cb61-195" aria-hidden="true" tabindex="-1"></a>Allerdings gibt es den Befehl <span class="in">`parameters`</span> in *zwei* Paketen, es käme also zu einem "Name Clash".</span>
<span id="cb61-196"><a href="#cb61-196" aria-hidden="true" tabindex="-1"></a>Das umgehen wir, indem wir <span class="in">`model_parameter`</span> nutzen, und nicht <span class="in">`parameters`</span>. </span>
<span id="cb61-197"><a href="#cb61-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-198"><a href="#cb61-198" aria-hidden="true" tabindex="-1"></a><span class="fu"># lm1: origin</span></span>
<span id="cb61-199"><a href="#cb61-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-200"><a href="#cb61-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-201"><a href="#cb61-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm1}</span></span>
<span id="cb61-202"><a href="#cb61-202" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(dep_delay <span class="sc">~</span> origin, <span class="at">data =</span> flights_train2)</span>
<span id="cb61-203"><a href="#cb61-203" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm1)  </span>
<span id="cb61-204"><a href="#cb61-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-205"><a href="#cb61-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-206"><a href="#cb61-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-207"><a href="#cb61-207" aria-hidden="true" tabindex="-1"></a>Man vergleiche:</span>
<span id="cb61-208"><a href="#cb61-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-209"><a href="#cb61-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flights2-compare}</span></span>
<span id="cb61-210"><a href="#cb61-210" aria-hidden="true" tabindex="-1"></a>flights_train2 <span class="sc">%&gt;%</span> </span>
<span id="cb61-211"><a href="#cb61-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(dep_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb61-212"><a href="#cb61-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span> </span>
<span id="cb61-213"><a href="#cb61-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">delay_avg =</span> <span class="fu">mean</span>(dep_delay)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-214"><a href="#cb61-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delay_delta =</span> delay_avg <span class="sc">-</span> delay_avg[<span class="dv">1</span>])</span>
<span id="cb61-215"><a href="#cb61-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-216"><a href="#cb61-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-217"><a href="#cb61-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-218"><a href="#cb61-218" aria-hidden="true" tabindex="-1"></a>Der Mittelwertsvergleich und das Modell <span class="in">`lm1`</span> sind faktisch informationsgleich.</span>
<span id="cb61-219"><a href="#cb61-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-220"><a href="#cb61-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-221"><a href="#cb61-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-222"><a href="#cb61-222" aria-hidden="true" tabindex="-1"></a>Aber leider ist es um die Modellgüte nicht so gut bestellt (eigentlich eher "grottenschlecht"):</span>
<span id="cb61-223"><a href="#cb61-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-224"><a href="#cb61-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r r2lm1}</span></span>
<span id="cb61-225"><a href="#cb61-225" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm1)</span>
<span id="cb61-226"><a href="#cb61-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-227"><a href="#cb61-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-228"><a href="#cb61-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-229"><a href="#cb61-229" aria-hidden="true" tabindex="-1"></a><span class="in">`lm1`</span> ist so schlecht, wir löschen es gleich wieder...</span>
<span id="cb61-232"><a href="#cb61-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-233"><a href="#cb61-233" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(lm1)</span>
<span id="cb61-234"><a href="#cb61-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-235"><a href="#cb61-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-236"><a href="#cb61-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-237"><a href="#cb61-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-238"><a href="#cb61-238" aria-hidden="true" tabindex="-1"></a><span class="fu"># lm2: All in</span></span>
<span id="cb61-239"><a href="#cb61-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-240"><a href="#cb61-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb61-241"><a href="#cb61-241" aria-hidden="true" tabindex="-1"></a><span class="co"># NICHT AUSFÜHREN</span></span>
<span id="cb61-242"><a href="#cb61-242" aria-hidden="true" tabindex="-1"></a><span class="co">#lm2_all_in &lt;- lm(dep_delay ~ ., data = flights_train2)</span></span>
<span id="cb61-243"><a href="#cb61-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-244"><a href="#cb61-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-245"><a href="#cb61-245" aria-hidden="true" tabindex="-1"></a>Modell <span class="in">`lm2_all_in`</span> ist hier *keine* gute Idee, da nominale Prädiktoren in Indikatorvariablen umgewandelt werden. Hat ein nominaler Prädiktor sehr viele Stufen (wie hier), so resultieren sehr viele Indikatorvariablen, was dem Regressionsmodell Probleme bereiten kann (bei mir hängt sich R auf). Besser ist es in dem Fall, die Anzahl der Stufen von nominalskalierten Variablen vorab zu begrenzen.</span>
<span id="cb61-246"><a href="#cb61-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-247"><a href="#cb61-247" aria-hidden="true" tabindex="-1"></a>Bei kleineren Datensätzen (weniger Variablen, weniger Fälle) lohnt es sich aber oft, das "All-in-Modell" auszuprobieren, als Referenzmaßstab für andere Modelle.</span>
<span id="cb61-248"><a href="#cb61-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-249"><a href="#cb61-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-250"><a href="#cb61-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-251"><a href="#cb61-251" aria-hidden="true" tabindex="-1"></a><span class="fu"># lm3: Verlorenes Modell</span></span>
<span id="cb61-252"><a href="#cb61-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-253"><a href="#cb61-253" aria-hidden="true" tabindex="-1"></a>Dieses Modell ging verloren. Wo ist es hin? Wie geht es ihm? Leider gibt es keine Antwort in dieser Fallstudie; aber vielleicht in einer anderen...</span>
<span id="cb61-254"><a href="#cb61-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-255"><a href="#cb61-255" aria-hidden="true" tabindex="-1"></a>Einigen Datensätzen ging es leider ebenso.^<span class="co">[</span><span class="ot">Hintergrund ist, dass diese Fallstudie eine vereinfachte und verkürzte Version einer ähnlichen Fallstudie ist.</span><span class="co">]</span></span>
<span id="cb61-256"><a href="#cb61-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-257"><a href="#cb61-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-258"><a href="#cb61-258" aria-hidden="true" tabindex="-1"></a><span class="fu"># lm4: Alle metrischen Variablen</span></span>
<span id="cb61-259"><a href="#cb61-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-260"><a href="#cb61-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-261"><a href="#cb61-261" aria-hidden="true" tabindex="-1"></a>Was sind noch mal unsere metrischen Variablen:</span>
<span id="cb61-262"><a href="#cb61-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-265"><a href="#cb61-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-266"><a href="#cb61-266" aria-hidden="true" tabindex="-1"></a>flights_train4 <span class="ot">&lt;-</span> </span>
<span id="cb61-267"><a href="#cb61-267" aria-hidden="true" tabindex="-1"></a>flights_train2 <span class="sc">%&gt;%</span> </span>
<span id="cb61-268"><a href="#cb61-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb61-269"><a href="#cb61-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>month, <span class="sc">-</span>day, <span class="sc">-</span>flight)   <span class="co"># diese Variablen sind nicht wirklich metrisch</span></span>
<span id="cb61-270"><a href="#cb61-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-271"><a href="#cb61-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-272"><a href="#cb61-272" aria-hidden="true" tabindex="-1"></a>flights_train4 <span class="sc">%&gt;%</span> </span>
<span id="cb61-273"><a href="#cb61-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb61-274"><a href="#cb61-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-275"><a href="#cb61-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-276"><a href="#cb61-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-277"><a href="#cb61-277" aria-hidden="true" tabindex="-1"></a>Ok, jetzt eine Regression mit diesen Variablen (ober ohne die ID-Variable):</span>
<span id="cb61-278"><a href="#cb61-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-279"><a href="#cb61-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm4}</span></span>
<span id="cb61-280"><a href="#cb61-280" aria-hidden="true" tabindex="-1"></a>lm4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(dep_delay <span class="sc">~</span> ., </span>
<span id="cb61-281"><a href="#cb61-281" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> (flights_train4 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>id)))</span>
<span id="cb61-282"><a href="#cb61-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-283"><a href="#cb61-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-284"><a href="#cb61-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-287"><a href="#cb61-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-288"><a href="#cb61-288" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm4)</span>
<span id="cb61-289"><a href="#cb61-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-290"><a href="#cb61-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-291"><a href="#cb61-291" aria-hidden="true" tabindex="-1"></a>Tja, das $R^2$ hat einen nicht gerade um ...</span>
<span id="cb61-292"><a href="#cb61-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-293"><a href="#cb61-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-296"><a href="#cb61-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-297"><a href="#cb61-297" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm4)</span>
<span id="cb61-298"><a href="#cb61-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-299"><a href="#cb61-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-300"><a href="#cb61-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-301"><a href="#cb61-301" aria-hidden="true" tabindex="-1"></a>Die Distanz zum Ziel ist offenbar der interessanteste Prädiktor.</span>
<span id="cb61-302"><a href="#cb61-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-303"><a href="#cb61-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-304"><a href="#cb61-304" aria-hidden="true" tabindex="-1"></a><span class="fu"># flights_train5: Fehlenden Werte ersetzen</span></span>
<span id="cb61-305"><a href="#cb61-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-306"><a href="#cb61-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-309"><a href="#cb61-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-310"><a href="#cb61-310" aria-hidden="true" tabindex="-1"></a>flights_train4 <span class="sc">|&gt;</span> </span>
<span id="cb61-311"><a href="#cb61-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">describe_distribution</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-312"><a href="#cb61-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Variable, n_Missing)</span>
<span id="cb61-313"><a href="#cb61-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-314"><a href="#cb61-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-315"><a href="#cb61-315" aria-hidden="true" tabindex="-1"></a>Glücklicherweise haben wir keine fehlende Werte.</span>
<span id="cb61-316"><a href="#cb61-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-317"><a href="#cb61-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-318"><a href="#cb61-318" aria-hidden="true" tabindex="-1"></a>Nur rein zu Übungszwecken: Falls es fehlende Werte gibt,</span>
<span id="cb61-319"><a href="#cb61-319" aria-hidden="true" tabindex="-1"></a>man könnte sie z.B. so mit dem Median ersetzen:</span>
<span id="cb61-320"><a href="#cb61-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-323"><a href="#cb61-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-324"><a href="#cb61-324" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="ot">&lt;-</span></span>
<span id="cb61-325"><a href="#cb61-325" aria-hidden="true" tabindex="-1"></a>  flights_train4 <span class="sc">|&gt;</span> </span>
<span id="cb61-326"><a href="#cb61-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance =</span> <span class="fu">replace_na</span>(distance, <span class="fu">median</span>(distance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb61-327"><a href="#cb61-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-328"><a href="#cb61-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-329"><a href="#cb61-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-330"><a href="#cb61-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-331"><a href="#cb61-331" aria-hidden="true" tabindex="-1"></a><span class="fu"># lm6: Wie lm5, aber ohne fehlende Werte</span></span>
<span id="cb61-332"><a href="#cb61-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-333"><a href="#cb61-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-334"><a href="#cb61-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-335"><a href="#cb61-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-336"><a href="#cb61-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm6}</span></span>
<span id="cb61-337"><a href="#cb61-337" aria-hidden="true" tabindex="-1"></a>lm6 <span class="ot">&lt;-</span><span class="fu">lm</span>(dep_delay <span class="sc">~</span> ., <span class="at">data =</span> flights_train5 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>id) )</span>
<span id="cb61-338"><a href="#cb61-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-339"><a href="#cb61-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-340"><a href="#cb61-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm6r2}</span></span>
<span id="cb61-341"><a href="#cb61-341" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm6)</span>
<span id="cb61-342"><a href="#cb61-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-343"><a href="#cb61-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-344"><a href="#cb61-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-347"><a href="#cb61-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-348"><a href="#cb61-348" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(lm6)</span>
<span id="cb61-349"><a href="#cb61-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-350"><a href="#cb61-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-351"><a href="#cb61-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-352"><a href="#cb61-352" aria-hidden="true" tabindex="-1"></a><span class="fu"># flights_train6: Extremwerte entfernen</span></span>
<span id="cb61-353"><a href="#cb61-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-354"><a href="#cb61-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-355"><a href="#cb61-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-densities}</span></span>
<span id="cb61-356"><a href="#cb61-356" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb61-357"><a href="#cb61-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric), <span class="sc">-</span>id) <span class="sc">|&gt;</span> </span>
<span id="cb61-358"><a href="#cb61-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_density</span>()</span>
<span id="cb61-359"><a href="#cb61-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-360"><a href="#cb61-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-361"><a href="#cb61-361" aria-hidden="true" tabindex="-1"></a>Es sieht so aus, als wäre <span class="in">`distance`</span> deutlich rechtsschief mit einigen Ausreißern.</span>
<span id="cb61-362"><a href="#cb61-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-363"><a href="#cb61-363" aria-hidden="true" tabindex="-1"></a>Man könnte auch Boxplots betrachten, die auch gut Extremwerte visualisieren.</span>
<span id="cb61-364"><a href="#cb61-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-365"><a href="#cb61-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-366"><a href="#cb61-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-367"><a href="#cb61-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-368"><a href="#cb61-368" aria-hidden="true" tabindex="-1"></a>Eine gängige Methode, mit Extremwerten umzugehen, ist, </span>
<span id="cb61-369"><a href="#cb61-369" aria-hidden="true" tabindex="-1"></a>alle Datenpunkte, die im Boxplot als alleinstehende Punkte gezeigt werden, durch den Median zu ersetzen.</span>
<span id="cb61-370"><a href="#cb61-370" aria-hidden="true" tabindex="-1"></a>Achtung: Diese Methode ist nicht perfekt! </span>
<span id="cb61-371"><a href="#cb61-371" aria-hidden="true" tabindex="-1"></a>Es gibt viel sophistiziertere Methoden.</span>
<span id="cb61-372"><a href="#cb61-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-373"><a href="#cb61-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-374"><a href="#cb61-374" aria-hidden="true" tabindex="-1"></a>Wir ersetzen dabei alle Werte von <span class="in">` distance`</span>, für die gilt, dass sie größer sind als Q3 + 1.5*IQR.</span>
<span id="cb61-375"><a href="#cb61-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-376"><a href="#cb61-376" aria-hidden="true" tabindex="-1"></a>Q3:</span>
<span id="cb61-377"><a href="#cb61-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-378"><a href="#cb61-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r comp-q3}</span></span>
<span id="cb61-379"><a href="#cb61-379" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb61-380"><a href="#cb61-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_q3 =</span> <span class="fu">quantile</span>(distance, <span class="at">prob =</span> .<span class="dv">75</span>))</span>
<span id="cb61-381"><a href="#cb61-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-382"><a href="#cb61-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-383"><a href="#cb61-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-384"><a href="#cb61-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-385"><a href="#cb61-385" aria-hidden="true" tabindex="-1"></a>IQR:</span>
<span id="cb61-386"><a href="#cb61-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-387"><a href="#cb61-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r comp-iqr}</span></span>
<span id="cb61-388"><a href="#cb61-388" aria-hidden="true" tabindex="-1"></a>flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb61-389"><a href="#cb61-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_iqr =</span> <span class="fu">IQR</span>(distance))</span>
<span id="cb61-390"><a href="#cb61-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-391"><a href="#cb61-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-392"><a href="#cb61-392" aria-hidden="true" tabindex="-1"></a>Der Grenzwert ist also:</span>
<span id="cb61-393"><a href="#cb61-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-394"><a href="#cb61-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r comp-threshold}</span></span>
<span id="cb61-395"><a href="#cb61-395" aria-hidden="true" tabindex="-1"></a>(<span class="co"># Q3</span></span>
<span id="cb61-396"><a href="#cb61-396" aria-hidden="true" tabindex="-1"></a>  flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb61-397"><a href="#cb61-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_iqr =</span> <span class="fu">quantile</span>(distance, <span class="at">prob =</span> .<span class="dv">75</span>)) </span>
<span id="cb61-398"><a href="#cb61-398" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-399"><a href="#cb61-399" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.5</span> <span class="sc">*</span> </span>
<span id="cb61-400"><a href="#cb61-400" aria-hidden="true" tabindex="-1"></a> (<span class="co"># IQR</span></span>
<span id="cb61-401"><a href="#cb61-401" aria-hidden="true" tabindex="-1"></a>  flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb61-402"><a href="#cb61-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_iqr =</span> <span class="fu">IQR</span>(distance)) </span>
<span id="cb61-403"><a href="#cb61-403" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb61-404"><a href="#cb61-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-405"><a href="#cb61-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-406"><a href="#cb61-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-407"><a href="#cb61-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-408"><a href="#cb61-408" aria-hidden="true" tabindex="-1"></a>Der Median von <span class="in">`distance`</span> beträgt übrigens:</span>
<span id="cb61-409"><a href="#cb61-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-410"><a href="#cb61-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r comp-md}</span></span>
<span id="cb61-411"><a href="#cb61-411" aria-hidden="true" tabindex="-1"></a> flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb61-412"><a href="#cb61-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_md =</span> <span class="fu">median</span>(distance)) </span>
<span id="cb61-413"><a href="#cb61-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-414"><a href="#cb61-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-415"><a href="#cb61-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-416"><a href="#cb61-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flights-train6}</span></span>
<span id="cb61-417"><a href="#cb61-417" aria-hidden="true" tabindex="-1"></a>flights_train6 <span class="ot">&lt;-</span></span>
<span id="cb61-418"><a href="#cb61-418" aria-hidden="true" tabindex="-1"></a>  flights_train5 <span class="sc">|&gt;</span> </span>
<span id="cb61-419"><a href="#cb61-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance =</span> </span>
<span id="cb61-420"><a href="#cb61-420" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(distance <span class="sc">&gt;</span> <span class="dv">2239</span> <span class="sc">~</span> <span class="dv">762</span>,</span>
<span id="cb61-421"><a href="#cb61-421" aria-hidden="true" tabindex="-1"></a>                     <span class="cn">TRUE</span> <span class="sc">~</span> distance))</span>
<span id="cb61-422"><a href="#cb61-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-423"><a href="#cb61-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-424"><a href="#cb61-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-425"><a href="#cb61-425" aria-hidden="true" tabindex="-1"></a>Grob auf Deutsch übersetzt:</span>
<span id="cb61-426"><a href="#cb61-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-427"><a href="#cb61-427" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;    Wenn ein Flug eine </span><span class="in">`distance`</span><span class="at"> von mehr als 326 Minuten hat, dann sei die airtime gleich 122, ansonsten immer ("TRUE") ist airtime gleich </span><span class="in">`distance`</span><span class="at">, bleibt also, wie sie war.</span></span>
<span id="cb61-428"><a href="#cb61-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-429"><a href="#cb61-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-430"><a href="#cb61-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-431"><a href="#cb61-431" aria-hidden="true" tabindex="-1"></a><span class="fu"># lm7: Wie lm5, aber ohne Extremwerte für `distance`</span></span>
<span id="cb61-432"><a href="#cb61-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-433"><a href="#cb61-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm7}</span></span>
<span id="cb61-434"><a href="#cb61-434" aria-hidden="true" tabindex="-1"></a>lm7 <span class="ot">&lt;-</span><span class="fu">lm</span>(dep_delay <span class="sc">~</span> ., <span class="at">data =</span> flights_train6)</span>
<span id="cb61-435"><a href="#cb61-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-436"><a href="#cb61-436" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(lm7)</span>
<span id="cb61-437"><a href="#cb61-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-438"><a href="#cb61-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-439"><a href="#cb61-439" aria-hidden="true" tabindex="-1"></a>Tja....</span>
<span id="cb61-440"><a href="#cb61-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-441"><a href="#cb61-441" aria-hidden="true" tabindex="-1"></a><span class="fu"># R2 im Testsample </span></span>
<span id="cb61-442"><a href="#cb61-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-443"><a href="#cb61-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-444"><a href="#cb61-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-445"><a href="#cb61-445" aria-hidden="true" tabindex="-1"></a>$R^2$ kann man übrigens auch so berechnen:</span>
<span id="cb61-446"><a href="#cb61-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-447"><a href="#cb61-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-448"><a href="#cb61-448" aria-hidden="true" tabindex="-1"></a>Zuerst fügen wir die Vorhersagen zum Datensatz hinzu:</span>
<span id="cb61-449"><a href="#cb61-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-450"><a href="#cb61-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm7-predict}</span></span>
<span id="cb61-451"><a href="#cb61-451" aria-hidden="true" tabindex="-1"></a>flights_train7_pred <span class="ot">&lt;-</span> </span>
<span id="cb61-452"><a href="#cb61-452" aria-hidden="true" tabindex="-1"></a>  flights_train6 <span class="sc">%&gt;%</span> </span>
<span id="cb61-453"><a href="#cb61-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lm7_pred =</span> <span class="fu">predict</span>(lm7, <span class="at">newdata =</span> flights_train6))  </span>
<span id="cb61-454"><a href="#cb61-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-455"><a href="#cb61-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-456"><a href="#cb61-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-457"><a href="#cb61-457" aria-hidden="true" tabindex="-1"></a>Dann berechnen wir das R-Quadrat mit der Funktion <span class="in">`rsq`</span> (wie "r squared", R-Quadrat) anhand der beiden relevanten Spalten:</span>
<span id="cb61-458"><a href="#cb61-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-459"><a href="#cb61-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flights_train7_pred-r2}</span></span>
<span id="cb61-460"><a href="#cb61-460" aria-hidden="true" tabindex="-1"></a>flights_train7_pred <span class="sc">%&gt;%</span> </span>
<span id="cb61-461"><a href="#cb61-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(<span class="at">truth =</span> dep_delay,</span>
<span id="cb61-462"><a href="#cb61-462" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> lm7_pred)</span>
<span id="cb61-463"><a href="#cb61-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-464"><a href="#cb61-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-465"><a href="#cb61-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-466"><a href="#cb61-466" aria-hidden="true" tabindex="-1"></a>Das ist nützlich, wenn man R-Quadrat auf Basis eigener Vorhersagen, im Test-Sample also, berechnen will.</span>
<span id="cb61-467"><a href="#cb61-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-468"><a href="#cb61-468" aria-hidden="true" tabindex="-1"></a>Berechnen wir jetzt die Modellgüte im Testsample.</span>
<span id="cb61-469"><a href="#cb61-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-470"><a href="#cb61-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-471"><a href="#cb61-471" aria-hidden="true" tabindex="-1"></a>Fügen wir die Vorhersagewerte dem Testsample dazu:</span>
<span id="cb61-472"><a href="#cb61-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-473"><a href="#cb61-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flights_test4_pred}</span></span>
<span id="cb61-474"><a href="#cb61-474" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="ot">&lt;-</span></span>
<span id="cb61-475"><a href="#cb61-475" aria-hidden="true" tabindex="-1"></a>  flights_test2 <span class="sc">%&gt;%</span> </span>
<span id="cb61-476"><a href="#cb61-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_lm7 =</span> <span class="fu">predict</span>(lm7, <span class="at">newdata =</span> flights_test2))</span>
<span id="cb61-477"><a href="#cb61-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-478"><a href="#cb61-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-479"><a href="#cb61-479" aria-hidden="true" tabindex="-1"></a>Check:</span>
<span id="cb61-480"><a href="#cb61-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-483"><a href="#cb61-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-484"><a href="#cb61-484" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="sc">%&gt;%</span> </span>
<span id="cb61-485"><a href="#cb61-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, dep_delay, pred_lm7) <span class="sc">%&gt;%</span></span>
<span id="cb61-486"><a href="#cb61-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb61-487"><a href="#cb61-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-488"><a href="#cb61-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-489"><a href="#cb61-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-490"><a href="#cb61-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-491"><a href="#cb61-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r test-r2}</span></span>
<span id="cb61-492"><a href="#cb61-492" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="sc">|&gt;</span> </span>
<span id="cb61-493"><a href="#cb61-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(<span class="at">truth =</span> dep_delay,</span>
<span id="cb61-494"><a href="#cb61-494" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> pred_lm7)</span>
<span id="cb61-495"><a href="#cb61-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-496"><a href="#cb61-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-497"><a href="#cb61-497" aria-hidden="true" tabindex="-1"></a>Am schwierigsten ist es, bei den ganzen Nummerierungen nicht durcheinander zu kommen. Hier könnte es sich lohnen, ein übersichtlicheres Verfahren einzuführen (mit den Kosten höherer Komplexität).</span>
<span id="cb61-498"><a href="#cb61-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-499"><a href="#cb61-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-500"><a href="#cb61-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-501"><a href="#cb61-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-502"><a href="#cb61-502" aria-hidden="true" tabindex="-1"></a><span class="fu"># Einreichen</span></span>
<span id="cb61-503"><a href="#cb61-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-504"><a href="#cb61-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-505"><a href="#cb61-505" aria-hidden="true" tabindex="-1"></a>Das beste Modell im *Train-Sample* reichen wir ein; in diesem Fall <span class="in">`lm7`</span>.</span>
<span id="cb61-506"><a href="#cb61-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-507"><a href="#cb61-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-508"><a href="#cb61-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-509"><a href="#cb61-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-510"><a href="#cb61-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r subm-df}</span></span>
<span id="cb61-511"><a href="#cb61-511" aria-hidden="true" tabindex="-1"></a>submission_df <span class="ot">&lt;-</span> </span>
<span id="cb61-512"><a href="#cb61-512" aria-hidden="true" tabindex="-1"></a>flights_test4_pred <span class="sc">|&gt;</span> </span>
<span id="cb61-513"><a href="#cb61-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="at">pred =</span> pred_lm7)  <span class="co"># gleich umbenennen in "pred"</span></span>
<span id="cb61-514"><a href="#cb61-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-515"><a href="#cb61-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-516"><a href="#cb61-516" aria-hidden="true" tabindex="-1"></a>Check:</span>
<span id="cb61-517"><a href="#cb61-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-520"><a href="#cb61-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-521"><a href="#cb61-521" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(submission_df)</span>
<span id="cb61-522"><a href="#cb61-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-523"><a href="#cb61-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-524"><a href="#cb61-524" aria-hidden="true" tabindex="-1"></a>Das sieht erstmal gut aus.</span>
<span id="cb61-525"><a href="#cb61-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-526"><a href="#cb61-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r write-csv, eval = FALSE}</span></span>
<span id="cb61-527"><a href="#cb61-527" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(submission_df, <span class="at">file =</span> <span class="st">"Sauer_Sebastian_0123456_Prognose.csv"</span>)</span>
<span id="cb61-528"><a href="#cb61-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-529"><a href="#cb61-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-530"><a href="#cb61-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-531"><a href="#cb61-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-532"><a href="#cb61-532" aria-hidden="true" tabindex="-1"></a><span class="fu"># Was noch?</span></span>
<span id="cb61-533"><a href="#cb61-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-534"><a href="#cb61-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-535"><a href="#cb61-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-536"><a href="#cb61-536" aria-hidden="true" tabindex="-1"></a>Ein nächster Schritt könnte sein, sich folgende Punkte anzuschauen:</span>
<span id="cb61-537"><a href="#cb61-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-538"><a href="#cb61-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-539"><a href="#cb61-539" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Nominale Variablen berücksichtigen</span>
<span id="cb61-540"><a href="#cb61-540" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Variablen mit der höchsten Korrelation berücksichtigen</span>
<span id="cb61-541"><a href="#cb61-541" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Interaktionseffekte berücksichtigen</span>
<span id="cb61-542"><a href="#cb61-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-543"><a href="#cb61-543" aria-hidden="true" tabindex="-1"></a>Eine Faustregel zu Interaktionen lautet: Wenn zwei Variablen jeweils einen starken Haupteffekt haben, lohnt es sich u.U., den Interaktionseffekt anzuschauen (vgl. Gelman &amp; Hill, 2007, S. 69).</span>
<span id="cb61-544"><a href="#cb61-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-545"><a href="#cb61-545" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Powered by <a href="https://quarto.org">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://sebastiansauer.github.io/Datenwerk/impressum.html">Impressum</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sebastiansauer/Datenwerk/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p><a href="https://sebastiansauer.github.io/Datenwerk/datenschutz.html">Datenschutzhinweise</a></p>
</div>
  </div>
</footer>




</body></html>